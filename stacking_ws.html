
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Modelo original &#8212; Proyecto Final</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'stacking_ws';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Modelos base" href="Modelos.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="Presentaci%C3%B3n.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/Logo-Uninorte.png" class="logo__image only-light" alt="Proyecto Final - Home"/>
    <script>document.write(`<img src="_static/Logo-Uninorte.png" class="logo__image only-dark" alt="Proyecto Final - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="Presentaci%C3%B3n.html">
                    Eco-Velocity
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Introducci%C3%B3n.html"><strong>Contextualización de la situación problema</strong></a></li>

<li class="toctree-l1"><a class="reference internal" href="AnalisisExploratorio.html"><strong>Análisis Exploratorio</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Modelos.html"><strong>Modelos base</strong></a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#"><strong>Modelo original</strong></a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fstacking_ws.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/stacking_ws.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Modelo original</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-bases"><strong>Modelos bases</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#funciones-utiles-e-importacion-de-datos-y-modelos-bases"><strong>Funciones útiles e importación de datos y modelos bases</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#seleccion-del-meta-learner"><strong>Selección del meta-learner</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#que-es-un-meta-learner">¿Qué es un meta-learner?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preparacion-de-datos-de-entrada-para-el-meta-learner">Preparación de datos de entrada para el meta-learner</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#meta-learner-con-3-modelos-base"><strong>Meta - learner con 3 modelos base</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regresion-lineal"><strong>Regresión lineal</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hiperparametrizacion-para-knn"><strong>Hiperparametrización para KNN</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hiperparametrizacion-para-ridge"><strong>Hiperparametrización para Ridge</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hiperparametrizacion-para-lasso"><strong>Hiperparametrización para Lasso</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hiperparametrizacion-para-arbol-de-decision"><strong>Hiperparametrización para árbol de decisión</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hiperparametrizacion-para-random-forest"><strong>Hiperparametrización para Random Forest</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hiperparametrizacion-para-xgboost"><strong>Hiperparametrización para XGBoost</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hiperparametrizacion-para-svr"><strong>Hiperparametrización para SVR</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resultados-generales"><strong>Resultados generales</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#meta-learner-con-4-modelos-bases"><strong>Meta-learner con 4 modelos bases</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1"><strong>Regresión lineal</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2"><strong>Hiperparametrización para KNN</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3"><strong>Hiperparametrización para Ridge</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4"><strong>Hiperparametrización para Lasso</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5"><strong>Hiperparametrización para árbol de decisión</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6"><strong>Hiperparametrización para Random Forest</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7"><strong>Hiperparametrización para XGBoost</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8"><strong>Hiperparametrización para SVR</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9"><strong>Resultados generales</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparacion-de-base-learners-y-meta-learners-con-4-y-3-base-learners"><strong>Comparación de base learners y meta learners con 4 y 3 base learners</strong></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="modelo-original">
<h1><strong>Modelo original</strong><a class="headerlink" href="#modelo-original" title="Link to this heading">#</a></h1>
<p>El modelo original propuesto en este proyecto se basa en la implementación del enfoque de <strong>pronóstico de velocidad del viento a corto plazo utilizando un modelo de ensamblaje apilado (stacking ensemble)</strong>, tal como se describe en el trabajo de <strong>Very Short-Term Wind Energy Forecasting Based on Stacking Ensemble</strong> de Sinvaldo R. Moreno et al. (2019). En este estudio, los autores utilizaron una combinación de cuatro modelos base, tales como <strong>eXtreme Gradient Boosting (XGBoost)</strong>, <strong>Support Vector Machine para regresión con Kernel Lineal (SVR-Linear)</strong>, <strong>Multi-Layer Perceptron (MLP)</strong> y <strong>K-Nearest Neighbors (K-NN)</strong>, con un <strong>meta-learner</strong> basado en <strong>Support Vector Machine con Kernel de Función Radial (SVR-RBF)</strong> para predecir la generación de energía eólica en una planta en Brasil. Este enfoque de <strong>stacking</strong> demostró ser más preciso que los modelos base por separado, al combinar los resultados de cada uno de los algoritmos. Para el presente proyecto, se utilizarán los cuatro modelos base más efectivos, seleccionados previamente, y se experimentará con distintos algoritmos como <strong>K-NN</strong>, <strong>Ridge</strong>, <strong>Lasso</strong>, <strong>Árboles de Decisión</strong>, <strong>Random Forest</strong>, <strong>XGBoost</strong>, <strong>SVR</strong> y <strong>Regresión Lineal</strong> como meta-learner para optimizar la predicción de la velocidad del viento. Este enfoque busca mejorar la precisión de las predicciones al aprovechar las fortalezas de varios modelos combinados de manera efectiva.</p>
<p><img alt="" src="logo.png" /></p>
<p>El flujo general del trabajo será el siguiente, donde se probaron con un metalearner con 3 baselearners correspondientes a los mejores 3 modelos bases</p>
<p><img alt="" src="_images/3bl.png" /></p>
<p>Y otro metalearner con 4 baselearners, los cuales corresponden a los mejores 4 modelos bases.</p>
<p><img alt="" src="_images/4bl.png" /></p>
<section id="modelos-bases">
<h2><strong>Modelos bases</strong><a class="headerlink" href="#modelos-bases" title="Link to this heading">#</a></h2>
<p>Se presentan a  continuación los resultados asociados a los modelos bases realizados en el apartado anterior. Se puede observar que además de estar ordenados por <span class="math notranslate nohighlight">\(R^2\)</span> también se encuantran ordenados por <span class="math notranslate nohighlight">\(RMSE\)</span>.</p>
<p>Para la implementación del modelo original, se tomaron los mejores cuatro modelos basados en <span class="math notranslate nohighlight">\(R^2\)</span> y <span class="math notranslate nohighlight">\(RMSE\)</span> y que sus residuos cumplieran los supuestos de independencia y normalidad.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;tablageneral.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">modelosbases</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modelosbases</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>MAE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>REG. LINEAL</td>
      <td>0.358341</td>
      <td>0.598616</td>
      <td>15.739528</td>
      <td>0.541310</td>
      <td>0.837850</td>
      <td>0.192736</td>
      <td>0.095363</td>
    </tr>
    <tr>
      <th>0</th>
      <td>RIDGE</td>
      <td>0.358581</td>
      <td>0.598816</td>
      <td>15.746817</td>
      <td>0.541537</td>
      <td>0.837741</td>
      <td>0.192629</td>
      <td>0.095406</td>
    </tr>
    <tr>
      <th>0</th>
      <td>SVR</td>
      <td>0.362467</td>
      <td>0.602052</td>
      <td>15.125073</td>
      <td>0.508772</td>
      <td>0.835983</td>
      <td>0.015236</td>
      <td>0.148630</td>
    </tr>
    <tr>
      <th>0</th>
      <td>LASSO</td>
      <td>0.468375</td>
      <td>0.684379</td>
      <td>15.627265</td>
      <td>0.586556</td>
      <td>0.788059</td>
      <td>0.284742</td>
      <td>0.050258</td>
    </tr>
    <tr>
      <th>0</th>
      <td>XGBOOST</td>
      <td>0.471152</td>
      <td>0.686405</td>
      <td>14.995415</td>
      <td>0.572242</td>
      <td>0.786802</td>
      <td>0.236152</td>
      <td>0.910029</td>
    </tr>
    <tr>
      <th>0</th>
      <td>RANDOM FOREST</td>
      <td>0.517051</td>
      <td>0.719063</td>
      <td>16.628608</td>
      <td>0.621354</td>
      <td>0.766033</td>
      <td>0.344430</td>
      <td>0.697858</td>
    </tr>
    <tr>
      <th>0</th>
      <td>DEC. TREE</td>
      <td>0.600514</td>
      <td>0.774928</td>
      <td>17.311127</td>
      <td>0.619180</td>
      <td>0.728266</td>
      <td>0.692234</td>
      <td>0.204984</td>
    </tr>
    <tr>
      <th>0</th>
      <td>KNN</td>
      <td>0.996620</td>
      <td>0.998308</td>
      <td>21.163538</td>
      <td>0.863542</td>
      <td>0.549027</td>
      <td>0.074711</td>
      <td>0.380957</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Es decir, con base a la tabla, los modelos que compondrían los <em><strong>base learners</strong></em> corresponden a <em>regresión lineal</em>, <em>regresión Ridge</em>, <em>regresión Lasso</em> y <em>XGBoost</em>. Modelos que por separado generan buenas predicciones y se esperaría que con base a estas predicciones se puedan generar predicciones más acertadas gracias al meta - modelo.</p>
</section>
<section id="funciones-utiles-e-importacion-de-datos-y-modelos-bases">
<h2><strong>Funciones útiles e importación de datos y modelos bases</strong><a class="headerlink" href="#funciones-utiles-e-importacion-de-datos-y-modelos-bases" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>joblib<span class="w"> </span>pandas<span class="w"> </span>numpy<span class="w"> </span>scikit-learn<span class="w"> </span>statsmodels<span class="w"> </span>matplotlib<span class="w"> </span>scikit-optimize<span class="w"> </span>xgboost
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.stattools</span> <span class="kn">import</span> <span class="n">jarque_bera</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.diagnostic</span> <span class="kn">import</span> <span class="n">acorr_ljungbox</span>

<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">,</span> <span class="n">Lasso</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">r2_score</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span><span class="p">,</span>
    <span class="n">mean_absolute_percentage_error</span><span class="p">,</span> <span class="n">mean_squared_log_error</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">KFold</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">skopt.space</span> <span class="kn">import</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Categorical</span><span class="p">,</span> <span class="n">Real</span>
<span class="kn">from</span> <span class="nn">skopt</span> <span class="kn">import</span> <span class="n">BayesSearchCV</span>

<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBRegressor</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">errorporc</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">predicho</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">actual</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">actual</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">actual</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">res</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">actual</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">predicho</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="n">actual</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">predicho</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>

<span class="k">def</span> <span class="nf">MAPE</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">errorporc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y_true</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y_pred</span><span class="p">))))</span><span class="o">*</span><span class="mi">100</span>

<span class="k">def</span> <span class="nf">residuos</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_prediccion</span><span class="p">):</span>
    <span class="n">residuo</span> <span class="o">=</span> <span class="n">y_test</span> <span class="o">-</span> <span class="n">y_prediccion</span>
    <span class="n">ljung</span> <span class="o">=</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuo</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;lb_pvalue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">jarque</span> <span class="o">=</span> <span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuo</span><span class="p">)</span>
    <span class="n">jarque</span> <span class="o">=</span> <span class="n">jarque</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ljung</span><span class="p">,</span> <span class="n">jarque</span>
</pre></div>
</div>
</div>
</div>
<p>Dado que cada observación corresponde a una hora específica del día, y estas están organizadas en bloques de 24 (es decir, cada 24 observaciones representan un día completo), se debe mantener este orden para evitar problemas como predecir el pasado a partir de datos futuros. Como nuestro objetivo es predecir las 24 horas siguientes, la partición se hizo manualmente: las últimas 24 observaciones se asignaron al conjunto de test, las 24 anteriores al conjunto de validación, y el resto de los datos (es decir, todos excepto las últimas 48 observaciones) se utilizaron como conjunto de entrenamiento.</p>
<p>Aqui también creamos los modelos bases con los parámetros obtenidos en el ejercicio pasado, es decir, la hiperparametrización de los modelos bases.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dividir_datos</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">24</span><span class="p">:]</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">48</span><span class="p">:</span><span class="o">-</span><span class="mi">24</span><span class="p">]</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">48</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;dataparcial2.csv&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;hora&#39;</span><span class="p">])</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;velocidadviento&#39;</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;velocidadviento&#39;</span><span class="p">]</span>

<span class="n">train</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">dividir_datos</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;velocidadviento&#39;</span><span class="p">]),</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;velocidadviento&#39;</span><span class="p">]</span>
<span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;velocidadviento&#39;</span><span class="p">]),</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;velocidadviento&#39;</span><span class="p">]</span>
<span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;velocidadviento&#39;</span><span class="p">]),</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;velocidadviento&#39;</span><span class="p">]</span>

<span class="n">modelolineal</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">modelolineal</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LinearRegression()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;LinearRegression<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.linear_model.LinearRegression.html">?<span>Documentation for LinearRegression</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>LinearRegression()</pre></div> </div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;modelolasso.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">modelolasso</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">trainlasso</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">predtrainlasso</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">testlasso</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">predlasso</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">metricaslasso</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;modeloridge.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">modeloridge</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">trainridge</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">predtrainridge</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">testridge</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">predridge</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">metricasridge</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;xgboostdata.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">modeloxgboost</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">trainxgboost</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">predtrainxgboost</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">testxgboost</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">predxgboost</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">metricasxgboost</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="seleccion-del-meta-learner">
<h2><strong>Selección del meta-learner</strong><a class="headerlink" href="#seleccion-del-meta-learner" title="Link to this heading">#</a></h2>
<p>Ahora se llevará a cabo un proceso de hiperparametrización para optimizar el rendimiento del meta-learner que se utilizará dentro del enfoque de ensamblaje apilado (stacking ensemble). El objetivo de la hiperparametrización es encontrar los valores óptimos de los hiperparámetros que controlan el comportamiento del meta-learner para mejorar la precisión de las predicciones.</p>
<section id="que-es-un-meta-learner">
<h3>¿Qué es un meta-learner?<a class="headerlink" href="#que-es-un-meta-learner" title="Link to this heading">#</a></h3>
<p>Un <strong>meta-learner</strong> es un modelo de aprendizaje automático que se utiliza dentro de un enfoque de <strong>ensamblaje</strong> (ensemble learning) para combinar las predicciones de otros modelos base (también conocidos como <strong>modelos base</strong> o <strong>learners</strong>). La idea principal es que el meta-learner aprende cómo combinar las salidas de los modelos base para hacer una predicción más precisa o robusta que la que cualquiera de los modelos base podría hacer por sí solo. En un <strong>stacking ensemble</strong> (ensamblaje apilado), los modelos base realizan predicciones sobre un conjunto de datos, y luego el <strong>meta-learner</strong> toma esas predicciones como sus propias características de entrada y las usa para generar una predicción final. El <strong>meta-learner</strong> no es un modelo independiente que trabaje directamente sobre los datos originales, sino que su tarea es aprender a <strong>combinar</strong> las predicciones de los modelos base.</p>
</section>
<section id="preparacion-de-datos-de-entrada-para-el-meta-learner">
<h3>Preparación de datos de entrada para el meta-learner<a class="headerlink" href="#preparacion-de-datos-de-entrada-para-el-meta-learner" title="Link to this heading">#</a></h3>
<p>Se seleccionan los mejores modelos de regresión obtenidos en las etapas previas del análisis, basándose en su rendimiento. Estos modelos son aquellos que han demostrado tener el mejor desempeño al predecir la variable objetivo durante la fase de validación. Una vez seleccionados, se procede a realizar nuevas predicciones sobre los conjuntos de datos de <strong>entrenamiento</strong> y <strong>validación</strong>, utilizando los modelos seleccionados.</p>
<p>Este paso es crucial porque las predicciones obtenidas de estos modelos base se utilizarán como entradas para el <strong>meta-learner</strong> en el modelo de ensamblaje apilado. Al generar las predicciones sobre el conjunto de <strong>entrenamiento</strong> (en lugar de solo utilizar los datos de validación), se garantiza que el <strong>meta-learner</strong> reciba las salidas más precisas y robustas posibles para aprender a combinarlas de manera óptima. El objetivo es que el <strong>meta-learner</strong> aproveche las fortalezas de los modelos base para mejorar aún más la predicción final de la variable objetivo, en este caso, la velocidad del viento.</p>
</section>
</section>
<section id="meta-learner-con-3-modelos-base">
<h2><strong>Meta - learner con 3 modelos base</strong><a class="headerlink" href="#meta-learner-con-3-modelos-base" title="Link to this heading">#</a></h2>
<p>En este caso, tal como se explicó en el flujo, se toman los tres mejores modelos, los cuales corresponden a Lasso, Ridge y regresión lineal. SVR no es tenido en cuenta debido a que sus residuos no cumplen los supuestos de independencia.</p>
<p><img alt="" src="_images/3bl.png" /></p>
<p>Organizamos además los conjuntos de entrenamiento, validación y test según los resultados obtenidos en los modelos mencionados para poder entrenar los diferentes metalearners.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_lasso</span> <span class="o">=</span> <span class="n">modelolasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">test_xgboost</span> <span class="o">=</span> <span class="n">modeloxgboost</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">test_ridge</span> <span class="o">=</span> <span class="n">modeloridge</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">test_lineal</span> <span class="o">=</span> <span class="n">modelolineal</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="n">train_lasso</span> <span class="o">=</span> <span class="n">modelolasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">train_xgboost</span> <span class="o">=</span> <span class="n">modeloxgboost</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">train_ridge</span> <span class="o">=</span> <span class="n">modeloridge</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">train_lineal</span> <span class="o">=</span> <span class="n">modelolineal</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

<span class="n">val_lasso</span> <span class="o">=</span> <span class="n">modelolasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
<span class="n">val_xgboost</span> <span class="o">=</span> <span class="n">modeloxgboost</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
<span class="n">val_ridge</span> <span class="o">=</span> <span class="n">modeloridge</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
<span class="n">val_lineal</span> <span class="o">=</span> <span class="n">modelolineal</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>

<span class="n">Xp_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">test_lasso</span><span class="p">,</span> <span class="n">test_ridge</span><span class="p">,</span> <span class="n">test_lineal</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">Xp_test</span> <span class="o">=</span> <span class="n">Xp_test</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;lasso&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;ridge&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="s1">&#39;lineal&#39;</span><span class="p">})</span>

<span class="n">Xp_val</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">val_lasso</span><span class="p">,</span> <span class="n">val_ridge</span><span class="p">,</span> <span class="n">val_lineal</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">Xp_val</span> <span class="o">=</span> <span class="n">Xp_val</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;lasso&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;ridge&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="s1">&#39;lineal&#39;</span><span class="p">})</span>

<span class="n">Xp_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">train_lasso</span><span class="p">,</span> <span class="n">train_ridge</span><span class="p">,</span> <span class="n">train_lineal</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">Xp_train</span> <span class="o">=</span> <span class="n">Xp_train</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;lasso&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;ridge&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="s1">&#39;lineal&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<section id="regresion-lineal">
<h3><strong>Regresión lineal</strong><a class="headerlink" href="#regresion-lineal" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reglin</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">reglin</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">ypredreglin</span> <span class="o">=</span> <span class="n">reglin</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msereglin</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredreglin</span><span class="p">)</span>
<span class="n">rmsereglin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">msereglin</span><span class="p">)</span>
<span class="n">mapereglin</span> <span class="o">=</span> <span class="n">MAPE</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">ypredreglin</span><span class="p">)</span>
<span class="n">maereglin</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredreglin</span><span class="p">)</span>
<span class="n">r2reglin</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredreglin</span><span class="p">)</span>
<span class="n">ljungboxreglin</span><span class="p">,</span> <span class="n">jarqueberareglin</span> <span class="o">=</span> <span class="n">residuos</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredreglin</span><span class="p">)</span>

<span class="n">valoresreglin</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;REG. LINEAL&#39;</span><span class="p">],</span><span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">msereglin</span><span class="p">],</span><span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmsereglin</span><span class="p">],</span><span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mapereglin</span><span class="p">],</span><span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">maereglin</span><span class="p">],</span><span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2reglin</span><span class="p">],</span><span class="s1">&#39;Ljung-Box p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ljungboxreglin</span><span class="p">],</span><span class="s1">&#39;Jarque-Bera p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">jarqueberareglin</span><span class="p">]}</span>
<span class="n">cuadro8</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">valoresreglin</span><span class="p">)</span>
<span class="n">cuadro8</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>MAE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>REG. LINEAL</td>
      <td>0.358341</td>
      <td>0.598616</td>
      <td>15.739528</td>
      <td>0.54131</td>
      <td>0.83785</td>
      <td>0.192736</td>
      <td>0.095363</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>El modelo de <strong>regresión lineal como metalearner con tres base-learners</strong> presenta un <strong>MSE</strong> de 0.36 y un <strong>RMSE</strong> de 0.59, lo que indica un error moderado en las predicciones. El <strong>MAPE</strong> de 15.74% indica que las predicciones están desviadas un 15.74% respecto a los valores reales. El modelo explica el 83.79% de la variabilidad de los datos. Los <strong>p-valores</strong> de las pruebas de Ljung-Box (0.192736) y Jarque-Bera (0.095363) validan la adecuación del modelo en términos de su error residual.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">graph_predictions</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">ypredtrain</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">ypred</span><span class="p">,</span> <span class="n">modelo</span><span class="p">):</span>
    <span class="n">n_display</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_display</span><span class="p">),</span> <span class="n">y_train</span><span class="p">[:</span><span class="n">n_display</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Valor Real (Entrenamiento)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#FF66B2&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_display</span><span class="p">),</span> <span class="n">ypredtrain</span><span class="p">[:</span><span class="n">n_display</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Valor Predicho (Entrenamiento)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#D3D3D3&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Índice&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Velocidad del viento&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">modelo</span><span class="si">}</span><span class="s2"> (Entrenamiento)</span><span class="se">\n</span><span class="s2">R²: </span><span class="si">{</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="w"> </span><span class="n">ypredtrain</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)),</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Valor Real (Prueba)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#FF3399&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ypred</span><span class="p">)),</span> <span class="n">ypred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Valor Predicho (Prueba)&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#D3D3D3&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Índice&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Velocidad del viento&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">modelo</span><span class="si">}</span><span class="s2"> (Prueba)</span><span class="se">\n</span><span class="s2">R²: </span><span class="si">{</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">ypred</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ypred</span> <span class="o">=</span> <span class="n">reglin</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">ypredtrain</span> <span class="o">=</span> <span class="n">reglin</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">)</span>
<span class="n">graph_predictions</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">ypredtrain</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;Regresión lineal&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3d0904620c8c9ac8e6af39fd0bc2f2e9189ba9e8b26f10960132034becf84f8e.png" src="_images/3d0904620c8c9ac8e6af39fd0bc2f2e9189ba9e8b26f10960132034becf84f8e.png" />
</div>
</div>
<p>Se observa una mejora del coeficiente de determinación en el conjunto de test. En general la regresión lineal como meta - learner parece ajustarse bien a los datos. Se notan problemas para predecir valores altos, la mayoría de veces, tanto en entrenamiento como en prueba, se predicen valores más abajos de los reales.</p>
</section>
<section id="hiperparametrizacion-para-knn">
<h3><strong>Hiperparametrización para KNN</strong><a class="headerlink" href="#hiperparametrizacion-para-knn" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">ParameterGrid</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>

<span class="n">r2_val</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">best_r2</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
<span class="n">best_k</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_p</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_metric</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_rmse</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># 450</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span> <span class="s1">&#39;manhattan&#39;</span><span class="p">,</span> <span class="s1">&#39;chebyshev&#39;</span><span class="p">]</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">ParameterGrid</span><span class="p">(</span><span class="n">param_grid</span><span class="p">):</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
    <span class="n">metric</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="n">knn</span> <span class="o">=</span> <span class="n">neighbors</span><span class="o">.</span><span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>
    <span class="n">knn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">knn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_val</span><span class="p">)</span>

    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">r2</span> <span class="o">&gt;</span> <span class="n">best_r2</span><span class="p">:</span>
        <span class="n">best_r2</span> <span class="o">=</span> <span class="n">r2</span>
        <span class="n">best_k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="n">best_p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="n">best_metric</span> <span class="o">=</span> <span class="n">metric</span>
        <span class="n">best_rmse</span> <span class="o">=</span> <span class="n">rmse</span>

    <span class="n">r2_val</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">rmse</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mejor R²: </span><span class="si">{</span><span class="n">best_r2</span><span class="si">}</span><span class="s2">, Mejor k: </span><span class="si">{</span><span class="n">best_k</span><span class="si">}</span><span class="s2">, Mejor p: </span><span class="si">{</span><span class="n">best_p</span><span class="si">}</span><span class="s2">, Mejor métrica: </span><span class="si">{</span><span class="n">best_metric</span><span class="si">}</span><span class="s2">, RMSE: </span><span class="si">{</span><span class="n">best_rmse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mejor R²: </span><span class="si">{</span><span class="n">best_r2</span><span class="si">}</span><span class="s2">, Mejor k: </span><span class="si">{</span><span class="n">best_k</span><span class="si">}</span><span class="s2">, Mejor p: </span><span class="si">{</span><span class="n">best_p</span><span class="si">}</span><span class="s2">, Mejor métrica: </span><span class="si">{</span><span class="n">best_metric</span><span class="si">}</span><span class="s2">, RMSE: </span><span class="si">{</span><span class="n">best_rmse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mejor R²: 0.6815315397384257, Mejor k: 19, Mejor p: 1, Mejor métrica: chebyshev, RMSE: 0.49544322471870333
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">knn</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span> <span class="o">=</span> <span class="mi">19</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span> <span class="s1">&#39;chebyshev&#39;</span><span class="p">)</span>
<span class="n">knn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">ypredknn</span> <span class="o">=</span> <span class="n">knn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">knn</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.7569964336148449
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mseknn</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredknn</span><span class="p">)</span>
<span class="n">rmseknn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mseknn</span><span class="p">)</span>
<span class="n">mapeknn</span> <span class="o">=</span><span class="n">MAPE</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">ypredknn</span><span class="p">)</span>
<span class="n">maeknn</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredknn</span><span class="p">)</span>
<span class="n">r2knn</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredknn</span><span class="p">)</span>
<span class="n">ljungboxknn</span><span class="p">,</span> <span class="n">jarqueberaknn</span> <span class="o">=</span> <span class="n">residuos</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredknn</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valoresknn</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;KNN&#39;</span><span class="p">],</span><span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mseknn</span><span class="p">],</span><span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmseknn</span><span class="p">],</span><span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mapeknn</span><span class="p">],</span><span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">maeknn</span><span class="p">],</span><span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2knn</span><span class="p">],</span><span class="s1">&#39;Ljung-Box p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ljungboxknn</span><span class="p">],</span><span class="s1">&#39;Jarque-Bera p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">jarqueberaknn</span><span class="p">]}</span>
<span class="n">cuadro1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">valoresknn</span><span class="p">)</span>
<span class="n">cuadro1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>MAE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>KNN</td>
      <td>0.537021</td>
      <td>0.732817</td>
      <td>16.449566</td>
      <td>0.605044</td>
      <td>0.756996</td>
      <td>0.144025</td>
      <td>0.229664</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>El modelo de <strong>KNN como metalearner</strong> muestra un desempeño general aceptable, con valores moderados de error como un <strong>MSE</strong> de 0.536753 y un <strong>RMSE</strong> de 0.732634, indicando el nivel promedio de desviación de las predicciones respecto a los datos reales. El <strong>MAPE</strong> de 16.37% refleja un error relativo promedio, mientras que el <strong>R²</strong> de 0.757118 indica que el modelo explica aproximadamente el 75.71% de la variabilidad en los datos. Los <strong>p-valores</strong> de las pruebas Ljung-Box (0.104821) y Jarque-Bera (0.208181) respaldan la estabilidad del modelo.</p>
<p>Llama la atención la mejora que tuvo este modelo respecto a KNN como modelo base, se ajustó mucho mejor a las predicciones de los otros modelos que a los valores originales.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ypred</span> <span class="o">=</span> <span class="n">knn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">ypredtrain</span> <span class="o">=</span> <span class="n">knn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">)</span>
<span class="n">graph_predictions</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">ypredtrain</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;KNN&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2364c17faccbcafb7c3a2569e4ff2d0c6dbd9a52a6de8e5f014fd2b162071e27.png" src="_images/2364c17faccbcafb7c3a2569e4ff2d0c6dbd9a52a6de8e5f014fd2b162071e27.png" />
</div>
</div>
<p>Se observan problemas para la predicción de valores muy altos nuevamente, tiene problemas para predecir picos como en la observación 17 de prueba. Como era de esperarse, hubo una disminución en el coeficiente de determinación en prueba.</p>
</section>
<section id="hiperparametrizacion-para-ridge">
<h3><strong>Hiperparametrización para Ridge</strong><a class="headerlink" href="#hiperparametrizacion-para-ridge" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">ParameterGrid</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">mean_squared_error</span>

<span class="n">r2_val</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">best_r2</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
<span class="n">best_alpha</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_solver</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_rmse</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
    <span class="s1">&#39;solver&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="s1">&#39;svd&#39;</span><span class="p">,</span> <span class="s1">&#39;cholesky&#39;</span><span class="p">,</span> <span class="s1">&#39;lsqr&#39;</span><span class="p">,</span> <span class="s1">&#39;sag&#39;</span><span class="p">,</span> <span class="s1">&#39;saga&#39;</span><span class="p">]</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">ParameterGrid</span><span class="p">(</span><span class="n">param_grid</span><span class="p">):</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
    <span class="n">solver</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;solver&#39;</span><span class="p">]</span>

    <span class="n">ridge</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="n">solver</span><span class="p">)</span>
    <span class="n">ridge</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">ridge</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_val</span><span class="p">)</span>

    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">r2</span> <span class="o">&gt;</span> <span class="n">best_r2</span><span class="p">:</span>
        <span class="n">best_r2</span> <span class="o">=</span> <span class="n">r2</span>
        <span class="n">best_alpha</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="n">best_solver</span> <span class="o">=</span> <span class="n">solver</span>
        <span class="n">best_rmse</span> <span class="o">=</span> <span class="n">rmse</span>

    <span class="n">r2_val</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">alpha</span><span class="p">,</span> <span class="n">solver</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">rmse</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mejor R²: </span><span class="si">{</span><span class="n">best_r2</span><span class="si">}</span><span class="s2">, Mejor alpha: </span><span class="si">{</span><span class="n">best_alpha</span><span class="si">}</span><span class="s2">, Mejor solver: </span><span class="si">{</span><span class="n">best_solver</span><span class="si">}</span><span class="s2">, RMSE: </span><span class="si">{</span><span class="n">best_rmse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mejor R²: 0.6345926572659613, Mejor alpha: 9.697272727272727, Mejor solver: sag, RMSE: 0.5307002774770735
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ridge</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">9.697272727272727</span><span class="p">,</span> <span class="n">solver</span> <span class="o">=</span> <span class="s1">&#39;sag&#39;</span><span class="p">)</span>
<span class="n">ridge</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">ypredridge</span> <span class="o">=</span> <span class="n">ridge</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">ridge</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8379060416855619
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mseridge</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredridge</span><span class="p">)</span>
<span class="n">rmseridge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mseridge</span><span class="p">)</span>
<span class="n">maperidge</span> <span class="o">=</span> <span class="n">MAPE</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredridge</span><span class="p">)</span>
<span class="n">maeridge</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredridge</span><span class="p">)</span>
<span class="n">r2ridge</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredridge</span><span class="p">)</span>
<span class="n">ljungboxridge</span><span class="p">,</span> <span class="n">jarqueberaridge</span> <span class="o">=</span> <span class="n">residuos</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredridge</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valoresridge</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;RIDGE&#39;</span><span class="p">],</span><span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mseridge</span><span class="p">],</span><span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmseridge</span><span class="p">],</span><span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">maperidge</span><span class="p">],</span><span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">maeridge</span><span class="p">],</span><span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2ridge</span><span class="p">],</span><span class="s1">&#39;Ljung-Box p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ljungboxridge</span><span class="p">],</span><span class="s1">&#39;Jarque-Bera p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">jarqueberaridge</span><span class="p">]}</span>
<span class="n">cuadro2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">valoresridge</span><span class="p">)</span>
<span class="n">cuadro2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>MAE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>RIDGE</td>
      <td>0.35826</td>
      <td>0.598549</td>
      <td>15.737396</td>
      <td>0.541237</td>
      <td>0.837886</td>
      <td>0.192711</td>
      <td>0.095328</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>El modelo <strong>Ridge</strong> parece tener un buen desempeño, con un <strong>MSE</strong> de 0.35 y un <strong>RMSE</strong> de 0.60. Su <strong>MAPE</strong> de 15.73% refleja un error relativo promedio razonable. El <strong>R²</strong> de 0.837886 muestra que el modelo explica el 83.79% de la variabilidad de los datos. Los <strong>p-valores</strong> de Ljung-Box (0.192711) y Jarque-Bera (0.095328) indican que los residuos del modelo no presentan autocorrelación significativa ni desviaciones significativas de la normalidad, sugiriendo que el modelo es adecuado.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ypred</span> <span class="o">=</span> <span class="n">ridge</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">ypredtrain</span> <span class="o">=</span> <span class="n">ridge</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">)</span>
<span class="n">graph_predictions</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">ypredtrain</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;Ridge&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ea7e3e9eed29a06bca86074d843a1c193686472ee618c985ee1f5e6c5713e972.png" src="_images/ea7e3e9eed29a06bca86074d843a1c193686472ee618c985ee1f5e6c5713e972.png" />
</div>
</div>
<p>En este modelo como meta learner, parece tener una mayor facilidad para predecir valores altos. Hubo una mejoría del conjunto de entrenamiento respecto al conjunto de prueba.</p>
</section>
<section id="hiperparametrizacion-para-lasso">
<h3><strong>Hiperparametrización para Lasso</strong><a class="headerlink" href="#hiperparametrizacion-para-lasso" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Lasso</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">ParameterGrid</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">mean_squared_error</span>

<span class="n">r2_val</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">best_r2</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
<span class="n">best_alpha</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_max_iter</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_tol</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_rmse</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># 1500</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
    <span class="s1">&#39;max_iter&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">2001</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span>
    <span class="s1">&#39;tol&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">ParameterGrid</span><span class="p">(</span><span class="n">param_grid</span><span class="p">):</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
    <span class="n">max_iter</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;max_iter&#39;</span><span class="p">]</span>
    <span class="n">tol</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;tol&#39;</span><span class="p">]</span>

    <span class="n">lasso</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="n">max_iter</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">)</span>
    <span class="n">lasso</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_val</span><span class="p">)</span>

    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">r2</span> <span class="o">&gt;</span> <span class="n">best_r2</span><span class="p">:</span>
        <span class="n">best_r2</span> <span class="o">=</span> <span class="n">r2</span>
        <span class="n">best_alpha</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="n">best_max_iter</span> <span class="o">=</span> <span class="n">max_iter</span>
        <span class="n">best_tol</span> <span class="o">=</span> <span class="n">tol</span>
        <span class="n">best_rmse</span> <span class="o">=</span> <span class="n">rmse</span>

    <span class="n">r2_val</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">alpha</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">,</span> <span class="n">tol</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">rmse</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mejor R²: </span><span class="si">{</span><span class="n">best_r2</span><span class="si">}</span><span class="s2">, Mejor alpha: </span><span class="si">{</span><span class="n">best_alpha</span><span class="si">}</span><span class="s2">, Mejor max_iter: </span><span class="si">{</span><span class="n">best_max_iter</span><span class="si">}</span><span class="s2">, Mejor tol: </span><span class="si">{</span><span class="n">best_tol</span><span class="si">}</span><span class="s2">, RMSE: </span><span class="si">{</span><span class="n">best_rmse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mejor R²: 0.6536422805223818, Mejor alpha: 0.21181818181818182, Mejor max_iter: 1000, Mejor tol: 0.0001, RMSE: 0.5166817422855736
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lasso</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.21181818181818182</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span> <span class="mi">1000</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span> <span class="mf">0.0001</span> <span class="p">)</span>
<span class="n">lasso</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">ypredlasso</span> <span class="o">=</span> <span class="n">lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">lasso</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8372873962542946
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mselasso</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredlasso</span><span class="p">)</span>
<span class="n">rmselasso</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mselasso</span><span class="p">)</span>
<span class="n">mapelasso</span> <span class="o">=</span> <span class="n">MAPE</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredlasso</span><span class="p">)</span>
<span class="n">maelasso</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredlasso</span><span class="p">)</span>
<span class="n">r2lasso</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredlasso</span><span class="p">)</span>
<span class="n">ljungboxlasso</span><span class="p">,</span> <span class="n">jarqueberalasso</span> <span class="o">=</span> <span class="n">residuos</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredlasso</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valoreslasso</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;LASSO&#39;</span><span class="p">],</span><span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mselasso</span><span class="p">],</span><span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmselasso</span><span class="p">],</span><span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mapelasso</span><span class="p">],</span><span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">maelasso</span><span class="p">],</span><span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2lasso</span><span class="p">],</span><span class="s1">&#39;Ljung-Box p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ljungboxlasso</span><span class="p">],</span><span class="s1">&#39;Jarque-Bera p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">jarqueberalasso</span><span class="p">]}</span>
<span class="n">cuadro3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">valoreslasso</span><span class="p">)</span>
<span class="n">cuadro3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>MAE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>LASSO</td>
      <td>0.359584</td>
      <td>0.599653</td>
      <td>15.70146</td>
      <td>0.541523</td>
      <td>0.837287</td>
      <td>0.219253</td>
      <td>0.092174</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>El modelo <strong>Lasso</strong> muestra un desempeño consistente con un <strong>MSE</strong> de 0.359584 y un <strong>RMSE</strong> de 0.599653, indicando un nivel moderado de error en las predicciones. Su <strong>MAPE</strong> de 15.70% sugiere una desviación relativa promedio similar a otros modelos. Con un <strong>R²</strong> de 0.837287, el modelo explica el 83.73% de la variabilidad de los datos. Los <strong>p-valores</strong> de Ljung-Box (0.219253) y Jarque-Bera (0.092174) indican que no hay evidencia significativa de autocorrelación ni desviaciones de la normalidad en los residuos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ypred</span> <span class="o">=</span> <span class="n">lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">ypredtrain</span> <span class="o">=</span> <span class="n">lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">)</span>
<span class="n">graph_predictions</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">ypredtrain</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;Lasso&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/807c2056672834f64eb854dd35d1af34bc5e70d7cfc9d6573c47c38c2b1b6c30.png" src="_images/807c2056672834f64eb854dd35d1af34bc5e70d7cfc9d6573c47c38c2b1b6c30.png" />
</div>
</div>
<p>En este modelo como meta learner, parece tener una mayor facilidad para predecir valores altos. Hubo una mejoría del conjunto de entrenamiento respecto al conjunto de prueba.</p>
</section>
<section id="hiperparametrizacion-para-arbol-de-decision">
<h3><strong>Hiperparametrización para árbol de decisión</strong><a class="headerlink" href="#hiperparametrizacion-para-arbol-de-decision" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">ParameterGrid</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">mean_squared_error</span>

<span class="n">r2_val</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">best_r2</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
<span class="n">best_max_depth</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_min_samples_split</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_min_samples_leaf</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_max_features</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_rmse</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1">#9000</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="s1">&#39;min_samples_split&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">ParameterGrid</span><span class="p">(</span><span class="n">param_grid</span><span class="p">):</span>
    <span class="n">max_depth</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;max_depth&#39;</span><span class="p">]</span>
    <span class="n">min_samples_split</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;min_samples_split&#39;</span><span class="p">]</span>

    <span class="n">tree</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span>
        <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
        <span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split</span>
    <span class="p">)</span>
    <span class="n">tree</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_val</span><span class="p">)</span>

    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">r2</span> <span class="o">&gt;</span> <span class="n">best_r2</span><span class="p">:</span>
        <span class="n">best_r2</span> <span class="o">=</span> <span class="n">r2</span>
        <span class="n">best_max_depth</span> <span class="o">=</span> <span class="n">max_depth</span>
        <span class="n">best_min_samples_split</span> <span class="o">=</span> <span class="n">min_samples_split</span>
        <span class="n">best_rmse</span> <span class="o">=</span> <span class="n">rmse</span>

    <span class="n">r2_val</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">rmse</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mejor R²: </span><span class="si">{</span><span class="n">best_r2</span><span class="si">}</span><span class="s2">, Mejor max_depth: </span><span class="si">{</span><span class="n">best_max_depth</span><span class="si">}</span><span class="s2">, Mejor min_samples_split: </span><span class="si">{</span><span class="n">best_min_samples_split</span><span class="si">}</span><span class="s2">  RMSE: </span><span class="si">{</span><span class="n">best_rmse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mejor R²: 0.6767721478983219, Mejor max_depth: 15, Mejor min_samples_split: 12  RMSE: 0.49913160216829794
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dectree</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span> <span class="mi">25</span><span class="p">)</span>

<span class="n">dectree</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">ypreddectree</span> <span class="o">=</span> <span class="n">dectree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">dectree</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6688673988409549
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msedectree</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypreddectree</span><span class="p">)</span>
<span class="n">rmsedectree</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">msedectree</span><span class="p">)</span>
<span class="n">mapedectree</span> <span class="o">=</span> <span class="n">MAPE</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypreddectree</span><span class="p">)</span>
<span class="n">maedectree</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypreddectree</span><span class="p">)</span>
<span class="n">r2dectree</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypreddectree</span><span class="p">)</span>
<span class="n">ljungboxdectree</span><span class="p">,</span> <span class="n">jarqueberadectree</span> <span class="o">=</span> <span class="n">residuos</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypreddectree</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valoresdectree</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;DEC. TREE&#39;</span><span class="p">],</span><span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">msedectree</span><span class="p">],</span><span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmsedectree</span><span class="p">],</span><span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mapedectree</span><span class="p">],</span><span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">maedectree</span><span class="p">],</span><span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2dectree</span><span class="p">],</span><span class="s1">&#39;Ljung-Box p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ljungboxdectree</span><span class="p">],</span><span class="s1">&#39;Jarque-Bera p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">jarqueberadectree</span><span class="p">]}</span>
<span class="n">cuadro4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">valoresdectree</span><span class="p">)</span>
<span class="n">cuadro4</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>MAE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>DEC. TREE</td>
      <td>0.73178</td>
      <td>0.855441</td>
      <td>17.89977</td>
      <td>0.685697</td>
      <td>0.668867</td>
      <td>0.002836</td>
      <td>0.489894</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>El modelo <strong>Decisión Tree</strong> presenta un desempeño más modesto en comparación con otros modelos, con un <strong>MSE</strong> de 0.73178 y un <strong>RMSE</strong> de 0.855441, lo que indica errores más altos en las predicciones. Su <strong>MAPE</strong> de 17.89% refleja una mayor desviación relativa promedio. El <strong>R²</strong> de 0.668867 sugiere que el modelo explica solo el 66.89% de la variabilidad de los datos. El <strong>p-valor</strong> bajo de Ljung-Box (0.002836) indica posibles problemas de autocorrelación en los residuos, mientras que el <strong>p-valor</strong> de Jarque-Bera (0.489894) no muestra evidencia significativa de no normalidad.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ypred</span> <span class="o">=</span> <span class="n">dectree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">ypredtrain</span> <span class="o">=</span> <span class="n">dectree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">)</span>
<span class="n">graph_predictions</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">ypredtrain</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;Árbol de decisión&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/79d5f3625118dbda996ae07455f1daeeb46c163bed6410a56552164c67e46d37.png" src="_images/79d5f3625118dbda996ae07455f1daeeb46c163bed6410a56552164c67e46d37.png" />
</div>
</div>
<p>Este modelo como meta learner, a diferencia de los observados anteriormente, aunque ya esperado por las métricas obtenidas, tiene un problema prediciendo los valores extremos. Aquellos valores, tanto en entrenamiento como en prueba que representan un pico y valores a los lados de los picos no son predichos correctamente por el árbol de decisión con tres base learners.</p>
</section>
<section id="hiperparametrizacion-para-random-forest">
<h3><strong>Hiperparametrización para Random Forest</strong><a class="headerlink" href="#hiperparametrizacion-para-random-forest" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">ParameterGrid</span>

<span class="n">r2_val</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">best_r2</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
<span class="n">best_n_estimators</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_max_depth</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_min_samples_split</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_min_samples_leaf</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_max_features</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_bootstrap</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_rmse</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># 5400</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
    <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">ParameterGrid</span><span class="p">(</span><span class="n">param_grid</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="n">n_estimators</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">]</span>
    <span class="n">max_depth</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;max_depth&#39;</span><span class="p">]</span>

    <span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span>
        <span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">25</span>
    <span class="p">)</span>

    <span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_val</span><span class="p">)</span>

    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">r2</span> <span class="o">&gt;</span> <span class="n">best_r2</span><span class="p">:</span>
        <span class="n">best_r2</span> <span class="o">=</span> <span class="n">r2</span>
        <span class="n">best_n_estimators</span> <span class="o">=</span> <span class="n">n_estimators</span>
        <span class="n">best_max_depth</span> <span class="o">=</span> <span class="n">max_depth</span>
        <span class="n">best_rmse</span> <span class="o">=</span> <span class="n">rmse</span>

    <span class="n">r2_val</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">n_estimators</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">rmse</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mejor R²: </span><span class="si">{</span><span class="n">best_r2</span><span class="si">}</span><span class="s2">, Mejor n_estimators: </span><span class="si">{</span><span class="n">best_n_estimators</span><span class="si">}</span><span class="s2">, Mejor max_depth: </span><span class="si">{</span><span class="n">best_max_depth</span><span class="si">}</span><span class="s2"> RMSE: </span><span class="si">{</span><span class="n">best_rmse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mejor R²: 0.6633629129782769, Mejor n_estimators: 10, Mejor max_depth: 10 RMSE: 0.5093797309837629
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ranfor</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span> <span class="mi">10</span><span class="p">,</span><span class="n">max_depth</span><span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span> <span class="mi">10</span><span class="p">)</span>

<span class="n">ranfor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">ypredranfor</span> <span class="o">=</span> <span class="n">ranfor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">ranfor</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.732367159035272
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mseranfor</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredranfor</span><span class="p">)</span>
<span class="n">rmseranfor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mseranfor</span><span class="p">)</span>
<span class="n">maperanfor</span> <span class="o">=</span> <span class="n">MAPE</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredranfor</span><span class="p">)</span>
<span class="n">maeranfor</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredranfor</span><span class="p">)</span>
<span class="n">r2ranfor</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredranfor</span><span class="p">)</span>
<span class="n">ljungboxranfor</span><span class="p">,</span> <span class="n">jarquebreranfor</span> <span class="o">=</span> <span class="n">residuos</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredranfor</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valoresranfor</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;RANDOM FOREST&#39;</span><span class="p">],</span><span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mseranfor</span><span class="p">],</span><span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmseranfor</span><span class="p">],</span><span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">maperanfor</span><span class="p">],</span><span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">maeranfor</span><span class="p">],</span><span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2ranfor</span><span class="p">],</span><span class="s1">&#39;Ljung-Box p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ljungboxranfor</span><span class="p">],</span><span class="s1">&#39;Jarque-Bera p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">jarquebreranfor</span><span class="p">]}</span>
<span class="n">cuadro5</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">valoresranfor</span><span class="p">)</span>
<span class="n">cuadro5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>MAE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>RANDOM FOREST</td>
      <td>0.59145</td>
      <td>0.769058</td>
      <td>17.172687</td>
      <td>0.652494</td>
      <td>0.732367</td>
      <td>0.05695</td>
      <td>0.055058</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>El modelo <strong>Random Forest</strong> muestra un rendimiento moderado con un <strong>MSE</strong> de 0.59145 y un <strong>RMSE</strong> de 0.769058, lo que indica una cantidad razonable de error en las predicciones. El <strong>R²</strong> de 0.732367 indica que el modelo explica aproximadamente el 73.24% de la variabilidad de los datos. Los <strong>p-valores</strong> de las pruebas de Ljung-Box (0.05695) y Jarque-Bera (0.055058) sugieren que los residuos no presentan autocorrelación significativa ni desviaciones importantes de normalidad.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ypred</span> <span class="o">=</span> <span class="n">ranfor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">ypredtrain</span> <span class="o">=</span> <span class="n">ranfor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">)</span>
<span class="n">graph_predictions</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">ypredtrain</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;Random forest&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c4e928ef5224aa25af8d5e4bb7565b542e1aaaf9baa0e3c51099afece8591538.png" src="_images/c4e928ef5224aa25af8d5e4bb7565b542e1aaaf9baa0e3c51099afece8591538.png" />
</div>
</div>
<p>Este tampoco tiene facilidades para valores extremos, en su mayoría predice valores por debajo de los valores reales, como el mismo caso del índice 17 y sus alrededores, donde predice valores muy inferiores a los esperados.</p>
</section>
<section id="hiperparametrizacion-para-xgboost">
<h3><strong>Hiperparametrización para XGBoost</strong><a class="headerlink" href="#hiperparametrizacion-para-xgboost" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r2_val</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">best_r2</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
<span class="n">best_n_estimators</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_max_depth</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_learning_rate</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_subsample</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_colsample_bytree</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_min_child_weight</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_gamma</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># 9600</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
    <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span>
    <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">ParameterGrid</span><span class="p">(</span><span class="n">param_grid</span><span class="p">):</span>
    <span class="n">n_estimators</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">]</span>
    <span class="n">max_depth</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;max_depth&#39;</span><span class="p">]</span>
    <span class="n">learning_rate</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">]</span>
    <span class="n">xgb</span> <span class="o">=</span> <span class="n">XGBRegressor</span><span class="p">(</span>
        <span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
        <span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span>
    <span class="p">)</span>

    <span class="n">xgb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_val</span><span class="p">)</span>

    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">r2</span> <span class="o">&gt;</span> <span class="n">best_r2</span><span class="p">:</span>
        <span class="n">best_r2</span> <span class="o">=</span> <span class="n">r2</span>
        <span class="n">best_n_estimators</span> <span class="o">=</span> <span class="n">n_estimators</span>
        <span class="n">best_max_depth</span> <span class="o">=</span> <span class="n">max_depth</span>
        <span class="n">best_learning_rate</span> <span class="o">=</span> <span class="n">learning_rate</span>

    <span class="n">r2_val</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">n_estimators</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">,</span> <span class="n">learning_rate</span><span class="p">,</span> <span class="n">r2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best R²: </span><span class="si">{</span><span class="n">best_r2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best n_estimators: </span><span class="si">{</span><span class="n">best_n_estimators</span><span class="si">}</span><span class="s2">, Best max_depth: </span><span class="si">{</span><span class="n">best_max_depth</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best learning_rate: </span><span class="si">{</span><span class="n">best_learning_rate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best R²: 0.721447901772885
Best n_estimators: 60, Best max_depth: 20
Best learning_rate: 0.2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xgboost</span> <span class="o">=</span> <span class="n">XGBRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span> <span class="mi">60</span><span class="p">,</span><span class="n">max_depth</span><span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>

<span class="n">xgboost</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">ypredxgboost</span> <span class="o">=</span> <span class="n">xgboost</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">xgboost</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.7604223368979899
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msexgboost</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredxgboost</span><span class="p">)</span>
<span class="n">rmsexgboost</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">msexgboost</span><span class="p">)</span>
<span class="n">mapexgboost</span> <span class="o">=</span> <span class="n">MAPE</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredxgboost</span><span class="p">)</span>
<span class="n">maexgboost</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredxgboost</span><span class="p">)</span>
<span class="n">r2xgboost</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredxgboost</span><span class="p">)</span>
<span class="n">ljungboxxgboost</span><span class="p">,</span> <span class="n">jarquebarexgboost</span> <span class="o">=</span> <span class="n">residuos</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredxgboost</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valoresxgboost</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;XGBOOST&#39;</span><span class="p">],</span><span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">msexgboost</span><span class="p">],</span><span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmsexgboost</span><span class="p">],</span><span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mapexgboost</span><span class="p">],</span><span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">maexgboost</span><span class="p">],</span><span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2xgboost</span><span class="p">],</span><span class="s1">&#39;Ljung-Box p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ljungboxxgboost</span><span class="p">],</span><span class="s1">&#39;Jarque-Bera p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">jarquebarexgboost</span><span class="p">]}</span>
<span class="n">cuadro6</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">valoresxgboost</span><span class="p">)</span>
<span class="n">cuadro6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>MAE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>XGBOOST</td>
      <td>0.52945</td>
      <td>0.727633</td>
      <td>16.132808</td>
      <td>0.573133</td>
      <td>0.760422</td>
      <td>0.751574</td>
      <td>0.282879</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ypred</span> <span class="o">=</span> <span class="n">xgboost</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">ypredtrain</span> <span class="o">=</span> <span class="n">xgboost</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">)</span>
<span class="n">graph_predictions</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">ypredtrain</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;XGBoost&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/fc267d8190e9fc3f6693beb0819feb25a4a576c6efddfd7ebf194ff2227efbcc.png" src="_images/fc267d8190e9fc3f6693beb0819feb25a4a576c6efddfd7ebf194ff2227efbcc.png" />
</div>
</div>
<p>Acá hay una mejoría respecto a los modelos anteriores respecto a los valores máximos, aún así, para los valores alrededores al índice 17 parece predecir el mismo valor, pues hay una línea recta, a´si que también está poniendo problemas para este tipo de registros con valores muy altos.</p>
</section>
<section id="hiperparametrizacion-para-svr">
<h3><strong>Hiperparametrización para SVR</strong><a class="headerlink" href="#hiperparametrizacion-para-svr" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">r2_val</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">best_r2</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
<span class="n">best_C</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_kernel</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_gamma</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_epsilon</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_tol</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_degree</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">for</span> <span class="n">C</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">kernel</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="s2">&quot;rbf&quot;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">gamma</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;auto&quot;</span><span class="p">]:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>
                        <span class="n">svr</span> <span class="o">=</span> <span class="n">SVR</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">)</span>

                        <span class="n">svr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

                        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">svr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_val</span><span class="p">)</span>

                        <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">r2</span> <span class="o">&gt;</span> <span class="n">best_r2</span><span class="p">:</span>
                            <span class="n">best_r2</span> <span class="o">=</span> <span class="n">r2</span>
                            <span class="n">best_C</span> <span class="o">=</span> <span class="n">C</span>
                            <span class="n">best_kernel</span> <span class="o">=</span> <span class="n">kernel</span>
                            <span class="n">best_gamma</span> <span class="o">=</span> <span class="n">gamma</span>

                        <span class="n">r2_val</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">C</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">r2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best R²: </span><span class="si">{</span><span class="n">best_r2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best C: </span><span class="si">{</span><span class="n">best_C</span><span class="si">}</span><span class="s2">, Best kernel: </span><span class="si">{</span><span class="n">best_kernel</span><span class="si">}</span><span class="s2">, Best gamma: </span><span class="si">{</span><span class="n">best_gamma</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best R²: 0.6617141483754992
Best C: 0.31000000000000005, Best kernel: rbf, Best gamma: auto
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">svr</span> <span class="o">=</span> <span class="n">SVR</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mf">0.31000000000000005</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;rbf&#39;</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>

<span class="n">svr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">ypredsvr</span> <span class="o">=</span> <span class="n">svr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">svr</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8535939651895693
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msesvr</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredsvr</span><span class="p">)</span>
<span class="n">rmsesvr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">msesvr</span><span class="p">)</span>
<span class="n">mapesvr</span> <span class="o">=</span><span class="n">MAPE</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">ypredsvr</span><span class="p">)</span>
<span class="n">maesvr</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredsvr</span><span class="p">)</span>
<span class="n">r2svr</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredsvr</span><span class="p">)</span>
<span class="n">ljungboxsvr</span><span class="p">,</span> <span class="n">jarquebaresvr</span> <span class="o">=</span> <span class="n">residuos</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredsvr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valoressvr</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;SVR&#39;</span><span class="p">],</span><span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">msesvr</span><span class="p">],</span><span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmsesvr</span><span class="p">],</span><span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mapesvr</span><span class="p">],</span><span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">maesvr</span><span class="p">],</span><span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2svr</span><span class="p">],</span><span class="s1">&#39;Ljung-Box p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ljungboxsvr</span><span class="p">],</span><span class="s1">&#39;Jarque-Bera p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">jarquebaresvr</span><span class="p">]}</span>
<span class="n">cuadro7</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">valoressvr</span><span class="p">)</span>
<span class="n">cuadro7</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>MAE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SVR</td>
      <td>0.323547</td>
      <td>0.568812</td>
      <td>14.558665</td>
      <td>0.501322</td>
      <td>0.853594</td>
      <td>0.124485</td>
      <td>0.098749</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>El modelo <strong>SVR</strong> (Support Vector Regression) muestra un desempeño destacado con un <strong>MSE</strong> de 0.323547 y un <strong>RMSE</strong> de 0.568812, lo que indica un error relativamente bajo en las predicciones. El <strong>MAPE</strong> de 14.56% refleja una desviación relativa promedio bastante buena. Con un <strong>R²</strong> de 0.853594, el modelo explica el 85.36% de la variabilidad de los datos, lo que sugiere una buena capacidad predictiva. Los <strong>p-valores</strong> de las pruebas de Ljung-Box (0.124485) y Jarque-Bera (0.098749) no indican problemas significativos de autocorrelación ni de no normalidad en los residuos, lo que respalda la estabilidad y validez del modelo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ypred</span> <span class="o">=</span> <span class="n">svr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">ypredtrain</span> <span class="o">=</span> <span class="n">svr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">)</span>
<span class="n">graph_predictions</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">ypredtrain</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;SVR&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/55fcdb9d74ddeefc984144f4ce96dd53303658b86b3acf525bd34481b9c1ecd9.png" src="_images/55fcdb9d74ddeefc984144f4ce96dd53303658b86b3acf525bd34481b9c1ecd9.png" />
</div>
</div>
<p>Este modelo, a diferencia de los visto anteriormente, presenta una mejoría considerebale en la predicción de esos datos muy altos, ya con un valor mucho más cercano al pico del índice 17.</p>
</section>
<section id="resultados-generales">
<h3><strong>Resultados generales</strong><a class="headerlink" href="#resultados-generales" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cuadro9</span> <span class="o">=</span> <span class="p">[</span><span class="n">cuadro1</span><span class="p">,</span> <span class="n">cuadro2</span><span class="p">,</span> <span class="n">cuadro3</span><span class="p">,</span> <span class="n">cuadro4</span><span class="p">,</span> <span class="n">cuadro5</span><span class="p">,</span> <span class="n">cuadro6</span><span class="p">,</span> <span class="n">cuadro7</span><span class="p">,</span> <span class="n">cuadro8</span><span class="p">]</span>
<span class="n">cuadro9</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">cuadro9</span><span class="p">)</span>
<span class="n">stacking_3bl</span> <span class="o">=</span> <span class="n">cuadro9</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">stacking_3bl</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>MAE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SVR</td>
      <td>0.323547</td>
      <td>0.568812</td>
      <td>14.558665</td>
      <td>0.501322</td>
      <td>0.853594</td>
      <td>0.124485</td>
      <td>0.098749</td>
    </tr>
    <tr>
      <th>0</th>
      <td>RIDGE</td>
      <td>0.358260</td>
      <td>0.598549</td>
      <td>15.737396</td>
      <td>0.541237</td>
      <td>0.837886</td>
      <td>0.192711</td>
      <td>0.095328</td>
    </tr>
    <tr>
      <th>0</th>
      <td>REG. LINEAL</td>
      <td>0.358341</td>
      <td>0.598616</td>
      <td>15.739528</td>
      <td>0.541310</td>
      <td>0.837850</td>
      <td>0.192736</td>
      <td>0.095363</td>
    </tr>
    <tr>
      <th>0</th>
      <td>LASSO</td>
      <td>0.359584</td>
      <td>0.599653</td>
      <td>15.701460</td>
      <td>0.541523</td>
      <td>0.837287</td>
      <td>0.219253</td>
      <td>0.092174</td>
    </tr>
    <tr>
      <th>0</th>
      <td>XGBOOST</td>
      <td>0.529450</td>
      <td>0.727633</td>
      <td>16.132808</td>
      <td>0.573133</td>
      <td>0.760422</td>
      <td>0.751574</td>
      <td>0.282879</td>
    </tr>
    <tr>
      <th>0</th>
      <td>KNN</td>
      <td>0.536753</td>
      <td>0.732634</td>
      <td>16.370041</td>
      <td>0.607353</td>
      <td>0.757118</td>
      <td>0.104821</td>
      <td>0.208181</td>
    </tr>
    <tr>
      <th>0</th>
      <td>RANDOM FOREST</td>
      <td>0.591450</td>
      <td>0.769058</td>
      <td>17.172687</td>
      <td>0.652494</td>
      <td>0.732367</td>
      <td>0.056950</td>
      <td>0.055058</td>
    </tr>
    <tr>
      <th>0</th>
      <td>DEC. TREE</td>
      <td>0.731780</td>
      <td>0.855441</td>
      <td>17.899770</td>
      <td>0.685697</td>
      <td>0.668867</td>
      <td>0.002836</td>
      <td>0.489894</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>De manera general, los modelos usados como meta learners con tres base learners evaluados muestran un rendimiento variado en cuanto a sus métricas de desempeño y pruebas estadísticas. Los modelos <strong>Support Vector Regression (SVR)</strong>, <strong>Ridge Regression</strong>, <strong>Regresión Lineal</strong>, y <strong>Lasso</strong> tienen valores de <strong>MSE</strong> y <strong>RMSE</strong> relativamente bajos, lo que indica errores moderados en las predicciones, y <strong>R²</strong> altos, lo que sugiere una buena capacidad para explicar la variabilidad de los datos. Estos modelos también muestran buenos resultados en las pruebas de normalidad (Jarque-Bera) y autocorrelación (Ljung-Box), lo que sugiere estabilidad en los residuos.</p>
<p>Por otro lado, los modelos como <strong>XGBoost</strong>, <strong>K-Nearest Neighbors (KNN)</strong>, y <strong>Random Forest</strong> presentan errores más altos en comparación con los anteriores, especialmente <strong>Random Forest</strong> y <strong>Decision Tree</strong>, que tienen <strong>MSE</strong> y <strong>RMSE</strong> significativamente mayores, lo que indica peores predicciones en términos de precisión. Sin embargo, estos modelos muestran una buena capacidad de ajuste en términos de <strong>R²</strong>. Además, la prueba de Ljung-Box de <strong>Decision Tree</strong> indica posibles problemas de autocorrelación en los residuos.</p>
</section>
</section>
<section id="meta-learner-con-4-modelos-bases">
<h2><strong>Meta-learner con 4 modelos bases</strong><a class="headerlink" href="#meta-learner-con-4-modelos-bases" title="Link to this heading">#</a></h2>
<p>Acá ahora se trabajará con el flujo representado de los cuadros mejores modelos bases como base learners. Se realizará la hiperparametrización de 8 tipos de modelos que trabajen como meta - learners.</p>
<p><img alt="" src="_images/4bl.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_lasso</span> <span class="o">=</span> <span class="n">modelolasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">train_xgboost</span> <span class="o">=</span> <span class="n">modeloxgboost</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">train_ridge</span> <span class="o">=</span> <span class="n">modeloridge</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">train_lineal</span> <span class="o">=</span> <span class="n">modelolineal</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

<span class="n">val_lasso</span> <span class="o">=</span> <span class="n">modelolasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
<span class="n">val_xgboost</span> <span class="o">=</span> <span class="n">modeloxgboost</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
<span class="n">val_ridge</span> <span class="o">=</span> <span class="n">modeloridge</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
<span class="n">val_lineal</span> <span class="o">=</span> <span class="n">modelolineal</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Xp_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">train_lasso</span><span class="p">,</span> <span class="n">train_xgboost</span><span class="p">,</span> <span class="n">train_ridge</span><span class="p">,</span> <span class="n">train_lineal</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">Xp_train</span> <span class="o">=</span> <span class="n">Xp_train</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;lasso&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;xgboost&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="s1">&#39;ridge&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="s1">&#39;lineal&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Xp_val</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">val_lasso</span><span class="p">,</span> <span class="n">val_xgboost</span><span class="p">,</span> <span class="n">val_ridge</span><span class="p">,</span> <span class="n">val_lineal</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">Xp_val</span> <span class="o">=</span> <span class="n">Xp_val</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;lasso&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;xgboost&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="s1">&#39;ridge&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="s1">&#39;lineal&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_lasso</span> <span class="o">=</span> <span class="n">modelolasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">test_xgboost</span> <span class="o">=</span> <span class="n">modeloxgboost</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">test_ridge</span> <span class="o">=</span> <span class="n">modeloridge</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">test_lineal</span> <span class="o">=</span> <span class="n">modelolineal</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="n">Xp_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">test_lasso</span><span class="p">,</span> <span class="n">test_xgboost</span><span class="p">,</span> <span class="n">test_ridge</span><span class="p">,</span> <span class="n">test_lineal</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">Xp_test</span> <span class="o">=</span> <span class="n">Xp_test</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;lasso&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;xgboost&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;ridge&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;lineal&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h3><strong>Regresión lineal</strong><a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reglin</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">reglin</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">ypredreglin</span> <span class="o">=</span> <span class="n">reglin</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msereglin</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredreglin</span><span class="p">)</span>
<span class="n">rmsereglin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">msereglin</span><span class="p">)</span>
<span class="n">mapereglin</span> <span class="o">=</span> <span class="n">MAPE</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">ypredreglin</span><span class="p">)</span>
<span class="n">maereglin</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredreglin</span><span class="p">)</span>
<span class="n">r2reglin</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredreglin</span><span class="p">)</span>
<span class="n">ljungboxreglin</span><span class="p">,</span> <span class="n">jarqueberareglin</span> <span class="o">=</span> <span class="n">residuos</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredreglin</span><span class="p">)</span>

<span class="n">valoresreglin</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;REG. LINEAL&#39;</span><span class="p">],</span><span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">msereglin</span><span class="p">],</span><span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmsereglin</span><span class="p">],</span><span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mapereglin</span><span class="p">],</span><span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">maereglin</span><span class="p">],</span><span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2reglin</span><span class="p">],</span><span class="s1">&#39;Ljung-Box p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ljungboxreglin</span><span class="p">],</span><span class="s1">&#39;Jarque-Bera p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">jarqueberareglin</span><span class="p">]}</span>
<span class="n">cuadro8</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">valoresreglin</span><span class="p">)</span>
<span class="n">cuadro8</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>MAE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>REG. LINEAL</td>
      <td>0.44722</td>
      <td>0.668745</td>
      <td>14.696839</td>
      <td>0.552116</td>
      <td>0.797632</td>
      <td>0.300747</td>
      <td>0.938138</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>El modelo <strong>regresión lineal con 4 base learners</strong> presenta un <strong>MSE</strong> de 0.44722 y un <strong>RMSE</strong> de 0.668745, lo que indica un error moderado en las predicciones. Con un <strong>R²</strong> de 0.797632, el modelo explica aproximadamente el 79.76% de la variabilidad de los datos, lo que sugiere una capacidad bastante buena para ajustarse a los datos. Los <strong>p-valores</strong> de las pruebas de Ljung-Box (0.300747) y Jarque-Bera (0.938138) indican que no hay evidencia significativa de autocorrelación ni de no normalidad en los residuos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ypred</span> <span class="o">=</span> <span class="n">reglin</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">ypredtrain</span> <span class="o">=</span> <span class="n">reglin</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">)</span>
<span class="n">graph_predictions</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">ypredtrain</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;Regresión lineal&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/bce4b9292ac7122b38eeaf02747359017cdc076407b1acc683a8ab048fc7edb4.png" src="_images/bce4b9292ac7122b38eeaf02747359017cdc076407b1acc683a8ab048fc7edb4.png" />
</div>
</div>
<p>Presentan los mismos problemas que modelos anteriores para la predicción de velocidades muy altas, el mismo problema encontrado alrededor del índice 17.</p>
</section>
<section id="id2">
<h3><strong>Hiperparametrización para KNN</strong><a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">ParameterGrid</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>

<span class="n">r2_val</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">best_r2</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
<span class="n">best_k</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_p</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_metric</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_rmse</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># 450</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span> <span class="s1">&#39;manhattan&#39;</span><span class="p">,</span> <span class="s1">&#39;chebyshev&#39;</span><span class="p">]</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">ParameterGrid</span><span class="p">(</span><span class="n">param_grid</span><span class="p">):</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">]</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
    <span class="n">metric</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="n">knn</span> <span class="o">=</span> <span class="n">neighbors</span><span class="o">.</span><span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>
    <span class="n">knn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">knn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_val</span><span class="p">)</span>

    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">r2</span> <span class="o">&gt;</span> <span class="n">best_r2</span><span class="p">:</span>
        <span class="n">best_r2</span> <span class="o">=</span> <span class="n">r2</span>
        <span class="n">best_k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="n">best_p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="n">best_metric</span> <span class="o">=</span> <span class="n">metric</span>
        <span class="n">best_rmse</span> <span class="o">=</span> <span class="n">rmse</span>

    <span class="n">r2_val</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">rmse</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mejor R²: </span><span class="si">{</span><span class="n">best_r2</span><span class="si">}</span><span class="s2">, Mejor k: </span><span class="si">{</span><span class="n">best_k</span><span class="si">}</span><span class="s2">, Mejor p: </span><span class="si">{</span><span class="n">best_p</span><span class="si">}</span><span class="s2">, Mejor métrica: </span><span class="si">{</span><span class="n">best_metric</span><span class="si">}</span><span class="s2">, RMSE: </span><span class="si">{</span><span class="n">best_rmse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mejor R²: 0.6309772949478636, Mejor k: 17, Mejor p: 1, Mejor métrica: chebyshev, RMSE: 0.5023990886642384
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">knn</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span> <span class="o">=</span> <span class="mi">17</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span> <span class="s1">&#39;chebyshev&#39;</span><span class="p">)</span>
<span class="n">knn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">ypredknn</span> <span class="o">=</span> <span class="n">knn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">knn</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8479633291713997
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mseknn</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredknn</span><span class="p">)</span>
<span class="n">rmseknn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mseknn</span><span class="p">)</span>
<span class="n">mapeknn</span> <span class="o">=</span><span class="n">MAPE</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">ypredknn</span><span class="p">)</span>
<span class="n">maeknn</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredknn</span><span class="p">)</span>
<span class="n">r2knn</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredknn</span><span class="p">)</span>
<span class="n">ljungboxknn</span><span class="p">,</span> <span class="n">jarqueberaknn</span> <span class="o">=</span> <span class="n">residuos</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredknn</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valoresknn</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;KNN&#39;</span><span class="p">],</span><span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mseknn</span><span class="p">],</span><span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmseknn</span><span class="p">],</span><span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mapeknn</span><span class="p">],</span><span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">maeknn</span><span class="p">],</span><span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2knn</span><span class="p">],</span><span class="s1">&#39;Ljung-Box p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ljungboxknn</span><span class="p">],</span><span class="s1">&#39;Jarque-Bera p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">jarqueberaknn</span><span class="p">]}</span>
<span class="n">cuadro1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">valoresknn</span><span class="p">)</span>
<span class="n">cuadro1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>MAE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>KNN</td>
      <td>0.33599</td>
      <td>0.579647</td>
      <td>13.482857</td>
      <td>0.48848</td>
      <td>0.847963</td>
      <td>0.466765</td>
      <td>0.60524</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>El modelo <strong>KNN</strong> muestra un <strong>MSE</strong> de 0.33599 y un <strong>RMSE</strong> de 0.579647, lo que indica errores moderadamente bajos en las predicciones. El <strong>MAPE</strong> de 13.48% refleja una desviación promedio razonable en comparación con los valores reales. Con un <strong>R²</strong> de 0.847963, el modelo explica el 84.80% de la variabilidad de los datos, lo que implica un ajuste bastante sólido. Los <strong>p-valores</strong> de las pruebas de Ljung-Box (0.466765) y Jarque-Bera (0.60524) sugieren que no hay evidencia significativa de autocorrelación ni de no normalidad en los residuos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ypred</span> <span class="o">=</span> <span class="n">knn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">ypredtrain</span> <span class="o">=</span> <span class="n">knn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">)</span>
<span class="n">graph_predictions</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">ypredtrain</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;KNN&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0c561abd7c67d57cf1dd1577864355b93fa4036629b72bf61088d563c9c4ff75.png" src="_images/0c561abd7c67d57cf1dd1577864355b93fa4036629b72bf61088d563c9c4ff75.png" />
</div>
</div>
<p>Presenta una mejora en la predicción de velocidades altas, se ajusta de mejor manera a valores alrededor del índice 17. Hubo mejoría en el coeficiente de determinación respecto al conjunto de entrenamiento.</p>
</section>
<section id="id3">
<h3><strong>Hiperparametrización para Ridge</strong><a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">ParameterGrid</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">mean_squared_error</span>

<span class="n">r2_val</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">best_r2</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
<span class="n">best_alpha</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_solver</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_rmse</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
    <span class="s1">&#39;solver&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="s1">&#39;svd&#39;</span><span class="p">,</span> <span class="s1">&#39;cholesky&#39;</span><span class="p">,</span> <span class="s1">&#39;lsqr&#39;</span><span class="p">,</span> <span class="s1">&#39;sag&#39;</span><span class="p">,</span> <span class="s1">&#39;saga&#39;</span><span class="p">]</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">ParameterGrid</span><span class="p">(</span><span class="n">param_grid</span><span class="p">):</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
    <span class="n">solver</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;solver&#39;</span><span class="p">]</span>

    <span class="n">ridge</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="n">solver</span><span class="p">)</span>
    <span class="n">ridge</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">ridge</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_val</span><span class="p">)</span>

    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">r2</span> <span class="o">&gt;</span> <span class="n">best_r2</span><span class="p">:</span>
        <span class="n">best_r2</span> <span class="o">=</span> <span class="n">r2</span>
        <span class="n">best_alpha</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="n">best_solver</span> <span class="o">=</span> <span class="n">solver</span>
        <span class="n">best_rmse</span> <span class="o">=</span> <span class="n">rmse</span>

    <span class="n">r2_val</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">alpha</span><span class="p">,</span> <span class="n">solver</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">rmse</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mejor R²: </span><span class="si">{</span><span class="n">best_r2</span><span class="si">}</span><span class="s2">, Mejor alpha: </span><span class="si">{</span><span class="n">best_alpha</span><span class="si">}</span><span class="s2">, Mejor solver: </span><span class="si">{</span><span class="n">best_solver</span><span class="si">}</span><span class="s2">, RMSE: </span><span class="si">{</span><span class="n">best_rmse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mejor R²: 0.6781671371143296, Mejor alpha: 0.01, Mejor solver: auto, RMSE: 0.49805335956100505
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ridge</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">solver</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">ridge</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">ypredridge</span> <span class="o">=</span> <span class="n">ridge</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">ridge</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.797106081086386
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mseridge</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredridge</span><span class="p">)</span>
<span class="n">rmseridge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mseridge</span><span class="p">)</span>
<span class="n">maperidge</span> <span class="o">=</span> <span class="n">MAPE</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredridge</span><span class="p">)</span>
<span class="n">maeridge</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredridge</span><span class="p">)</span>
<span class="n">r2ridge</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredridge</span><span class="p">)</span>
<span class="n">ljungboxridge</span><span class="p">,</span> <span class="n">jarqueberaridge</span> <span class="o">=</span> <span class="n">residuos</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredridge</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valoresridge</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;RIDGE&#39;</span><span class="p">],</span><span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mseridge</span><span class="p">],</span><span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmseridge</span><span class="p">],</span><span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">maperidge</span><span class="p">],</span><span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">maeridge</span><span class="p">],</span><span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2ridge</span><span class="p">],</span><span class="s1">&#39;Ljung-Box p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ljungboxridge</span><span class="p">],</span><span class="s1">&#39;Jarque-Bera p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">jarqueberaridge</span><span class="p">]}</span>
<span class="n">cuadro2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">valoresridge</span><span class="p">)</span>
<span class="n">cuadro2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>MAE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>RIDGE</td>
      <td>0.448381</td>
      <td>0.669613</td>
      <td>14.718895</td>
      <td>0.552965</td>
      <td>0.797106</td>
      <td>0.299967</td>
      <td>0.937912</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>El modelo <strong>regresión ridge</strong> presenta un <strong>MSE</strong> de 0.448381 y un <strong>RMSE</strong> de 0.669613, lo que indica errores moderados en las predicciones. Con un <strong>R²</strong> de 0.797106, el modelo explica aproximadamente el 79.71% de la variabilidad de los datos, lo que sugiere una capacidad adecuada para ajustarse a los datos. Los <strong>p-valores</strong> de las pruebas de Ljung-Box (0.299967) y Jarque-Bera (0.937912) indican que no hay evidencia significativa de autocorrelación ni de no normalidad en los residuos, lo que sugiere que el modelo es estable y sus residuos siguen un comportamiento adecuado.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ypred</span> <span class="o">=</span> <span class="n">ridge</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">ypredtrain</span> <span class="o">=</span> <span class="n">ridge</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">)</span>
<span class="n">graph_predictions</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">ypredtrain</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;Ridge&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/fd6713f065d2a946ef03a79c0a8f6329b5ab7f929a22b5364c3f17eb1ad13b77.png" src="_images/fd6713f065d2a946ef03a79c0a8f6329b5ab7f929a22b5364c3f17eb1ad13b77.png" />
</div>
</div>
<p>Al igual que lo sucedido con el modelo de tres base learners, tiene los mismos problemas para la predicción de velocidades altas. Como era de esperarse, se obtuvo un coeficiente de determinación menor en el conjunto de prueba.</p>
</section>
<section id="id4">
<h3><strong>Hiperparametrización para Lasso</strong><a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Lasso</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">ParameterGrid</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">mean_squared_error</span>

<span class="n">r2_val</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">best_r2</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
<span class="n">best_alpha</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_max_iter</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_tol</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_rmse</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># 1500</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
    <span class="s1">&#39;max_iter&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">2001</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span>
    <span class="s1">&#39;tol&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">ParameterGrid</span><span class="p">(</span><span class="n">param_grid</span><span class="p">):</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
    <span class="n">max_iter</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;max_iter&#39;</span><span class="p">]</span>
    <span class="n">tol</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;tol&#39;</span><span class="p">]</span>

    <span class="n">lasso</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="n">max_iter</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">)</span>
    <span class="n">lasso</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_val</span><span class="p">)</span>

    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">r2</span> <span class="o">&gt;</span> <span class="n">best_r2</span><span class="p">:</span>
        <span class="n">best_r2</span> <span class="o">=</span> <span class="n">r2</span>
        <span class="n">best_alpha</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="n">best_max_iter</span> <span class="o">=</span> <span class="n">max_iter</span>
        <span class="n">best_tol</span> <span class="o">=</span> <span class="n">tol</span>
        <span class="n">best_rmse</span> <span class="o">=</span> <span class="n">rmse</span>

    <span class="n">r2_val</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">alpha</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">,</span> <span class="n">tol</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">rmse</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mejor R²: </span><span class="si">{</span><span class="n">best_r2</span><span class="si">}</span><span class="s2">, Mejor alpha: </span><span class="si">{</span><span class="n">best_alpha</span><span class="si">}</span><span class="s2">, Mejor max_iter: </span><span class="si">{</span><span class="n">best_max_iter</span><span class="si">}</span><span class="s2">, Mejor tol: </span><span class="si">{</span><span class="n">best_tol</span><span class="si">}</span><span class="s2">, RMSE: </span><span class="si">{</span><span class="n">best_rmse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mejor R²: 0.6857109727630712, Mejor alpha: 0.01, Mejor max_iter: 1000, Mejor tol: 0.0001, RMSE: 0.492181503988357
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lasso</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span> <span class="mi">1000</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span> <span class="mf">0.0001</span> <span class="p">)</span>
<span class="n">lasso</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">ypredlasso</span> <span class="o">=</span> <span class="n">lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">lasso</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8024634427792195
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mselasso</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredlasso</span><span class="p">)</span>
<span class="n">rmselasso</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mselasso</span><span class="p">)</span>
<span class="n">mapelasso</span> <span class="o">=</span> <span class="n">MAPE</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredlasso</span><span class="p">)</span>
<span class="n">maelasso</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredlasso</span><span class="p">)</span>
<span class="n">r2lasso</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredlasso</span><span class="p">)</span>
<span class="n">ljungboxlasso</span><span class="p">,</span> <span class="n">jarqueberalasso</span> <span class="o">=</span> <span class="n">residuos</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredlasso</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valoreslasso</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;LASSO&#39;</span><span class="p">],</span><span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mselasso</span><span class="p">],</span><span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmselasso</span><span class="p">],</span><span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mapelasso</span><span class="p">],</span><span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">maelasso</span><span class="p">],</span><span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2lasso</span><span class="p">],</span><span class="s1">&#39;Ljung-Box p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ljungboxlasso</span><span class="p">],</span><span class="s1">&#39;Jarque-Bera p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">jarqueberalasso</span><span class="p">]}</span>
<span class="n">cuadro3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">valoreslasso</span><span class="p">)</span>
<span class="n">cuadro3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>MAE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>LASSO</td>
      <td>0.436542</td>
      <td>0.660713</td>
      <td>14.735133</td>
      <td>0.549878</td>
      <td>0.802463</td>
      <td>0.319511</td>
      <td>0.929675</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ypred</span> <span class="o">=</span> <span class="n">lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">ypredtrain</span> <span class="o">=</span> <span class="n">lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">)</span>
<span class="n">graph_predictions</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">ypredtrain</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;Lasso&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/eff01822e429d7a6d6e32cbc2f391873ef25bf4c8d8dcc2e584605170143381a.png" src="_images/eff01822e429d7a6d6e32cbc2f391873ef25bf4c8d8dcc2e584605170143381a.png" />
</div>
</div>
<p>No hubo una gran diferencia respecto al modelo con Ridge de cuatro baselearners, presenta el mismo problema de la predicción de datos ‘extremos’.</p>
<p>El modelo <strong>Lasso</strong> presenta un <strong>MSE</strong> de 0.436542 y un <strong>RMSE</strong> de 0.660713, lo que indica un error moderado en las predicciones. Con un <strong>R²</strong> de 0.802463, el modelo explica aproximadamente el 80.25% de la variabilidad de los datos, lo que sugiere un ajuste adecuado. Los <strong>p-valores</strong> de las pruebas de Ljung-Box (0.319511) y Jarque-Bera (0.929675) indican que no hay evidencia significativa de autocorrelación ni de no normalidad en los residuos, lo que sugiere que el modelo es estable y sus residuos siguen un comportamiento adecuado.</p>
</section>
<section id="id5">
<h3><strong>Hiperparametrización para árbol de decisión</strong><a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">ParameterGrid</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">mean_squared_error</span>

<span class="n">r2_val</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">best_r2</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
<span class="n">best_max_depth</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_min_samples_split</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_min_samples_leaf</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_max_features</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_rmse</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1">#9000</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="s1">&#39;min_samples_split&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
    <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
    <span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="s1">&#39;log2&#39;</span><span class="p">]</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">ParameterGrid</span><span class="p">(</span><span class="n">param_grid</span><span class="p">):</span>
    <span class="n">max_depth</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;max_depth&#39;</span><span class="p">]</span>
    <span class="n">min_samples_split</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;min_samples_split&#39;</span><span class="p">]</span>
    <span class="n">min_samples_leaf</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">]</span>
    <span class="n">max_features</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;max_features&#39;</span><span class="p">]</span>

    <span class="n">tree</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span>
        <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
        <span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split</span><span class="p">,</span>
        <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf</span><span class="p">,</span>
        <span class="n">max_features</span><span class="o">=</span><span class="n">max_features</span>
    <span class="p">)</span>
    <span class="n">tree</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_val</span><span class="p">)</span>

    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">r2</span> <span class="o">&gt;</span> <span class="n">best_r2</span><span class="p">:</span>
        <span class="n">best_r2</span> <span class="o">=</span> <span class="n">r2</span>
        <span class="n">best_max_depth</span> <span class="o">=</span> <span class="n">max_depth</span>
        <span class="n">best_min_samples_split</span> <span class="o">=</span> <span class="n">min_samples_split</span>
        <span class="n">best_min_samples_leaf</span> <span class="o">=</span> <span class="n">min_samples_leaf</span>
        <span class="n">best_max_features</span> <span class="o">=</span> <span class="n">max_features</span>
        <span class="n">best_rmse</span> <span class="o">=</span> <span class="n">rmse</span>

    <span class="n">r2_val</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="p">,</span> <span class="n">max_features</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">rmse</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mejor R²: </span><span class="si">{</span><span class="n">best_r2</span><span class="si">}</span><span class="s2">, Mejor max_depth: </span><span class="si">{</span><span class="n">best_max_depth</span><span class="si">}</span><span class="s2">, Mejor min_samples_split: </span><span class="si">{</span><span class="n">best_min_samples_split</span><span class="si">}</span><span class="s2">, Mejor min_samples_leaf: </span><span class="si">{</span><span class="n">best_min_samples_leaf</span><span class="si">}</span><span class="s2">, Mejor max_features: </span><span class="si">{</span><span class="n">best_max_features</span><span class="si">}</span><span class="s2">, RMSE: </span><span class="si">{</span><span class="n">best_rmse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mejor R²: 0.7493898792813629, Mejor max_depth: 20, Mejor min_samples_split: 12, Mejor min_samples_leaf: 3, Mejor max_features: log2, RMSE: 0.43950111631258754
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dectree</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="s1">&#39;log2&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">dectree</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">ypreddectree</span> <span class="o">=</span> <span class="n">dectree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">dectree</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8136027544959185
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msedectree</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypreddectree</span><span class="p">)</span>
<span class="n">rmsedectree</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">msedectree</span><span class="p">)</span>
<span class="n">mapedectree</span> <span class="o">=</span> <span class="n">MAPE</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypreddectree</span><span class="p">)</span>
<span class="n">maedectree</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypreddectree</span><span class="p">)</span>
<span class="n">r2dectree</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypreddectree</span><span class="p">)</span>
<span class="n">ljungboxdectree</span><span class="p">,</span> <span class="n">jarqueberadectree</span> <span class="o">=</span> <span class="n">residuos</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypreddectree</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valoresdectree</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;DEC. TREE&#39;</span><span class="p">],</span><span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">msedectree</span><span class="p">],</span><span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmsedectree</span><span class="p">],</span><span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mapedectree</span><span class="p">],</span><span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">maedectree</span><span class="p">],</span><span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2dectree</span><span class="p">],</span><span class="s1">&#39;Ljung-Box p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ljungboxdectree</span><span class="p">],</span><span class="s1">&#39;Jarque-Bera p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">jarqueberadectree</span><span class="p">]}</span>
<span class="n">cuadro4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">valoresdectree</span><span class="p">)</span>
<span class="n">cuadro4</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>MAE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>DEC. TREE</td>
      <td>0.411925</td>
      <td>0.641814</td>
      <td>13.792041</td>
      <td>0.499719</td>
      <td>0.813603</td>
      <td>0.400202</td>
      <td>0.397399</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>El modelo <strong>Decision Tree</strong> presenta un <strong>MSE</strong> de 0.411925 y un <strong>RMSE</strong> de 0.641814, lo que indica errores moderadamente bajos en las predicciones. El <strong>MAPE</strong> de 13.79% refleja una desviación razonable con respecto a los valores reales. Con un <strong>R²</strong> de 0.813603, el modelo explica aproximadamente el 81.36% de la variabilidad de los datos, lo que sugiere un buen ajuste. Los <strong>p-valores</strong> de las pruebas de Ljung-Box (0.400202) y Jarque-Bera (0.397399) indican que no hay evidencia significativa de autocorrelación ni de no normalidad en los residuos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ypred</span> <span class="o">=</span> <span class="n">dectree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">ypredtrain</span> <span class="o">=</span> <span class="n">dectree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">)</span>
<span class="n">graph_predictions</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">ypredtrain</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;Árbol de decisión&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8129b0b043e8f6dd81fb977f7b4de6953d8d402fa62375b9cbad489f123b9640.png" src="_images/8129b0b043e8f6dd81fb977f7b4de6953d8d402fa62375b9cbad489f123b9640.png" />
</div>
</div>
<p>Se obtuvo un excelente score en entrenamiento, del 87%. Hubo una disminución del coeficiente de determinación del 6% en prueba, aún así, se ajustó bastante bien a los valores extremos a diferencia del árbol de decisión con tres base learners. Se notan predicciones muy malas, como en el índice 7 aproximadamene.</p>
</section>
<section id="id6">
<h3><strong>Hiperparametrización para Random Forest</strong><a class="headerlink" href="#id6" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">ParameterGrid</span>

<span class="n">r2_val</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">best_r2</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
<span class="n">best_n_estimators</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_max_depth</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_min_samples_split</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_min_samples_leaf</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_max_features</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_bootstrap</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_rmse</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># 5400</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
    <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">ParameterGrid</span><span class="p">(</span><span class="n">param_grid</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="n">n_estimators</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">]</span>
    <span class="n">max_depth</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;max_depth&#39;</span><span class="p">]</span>

    <span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span>
        <span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">25</span>
    <span class="p">)</span>

    <span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_val</span><span class="p">)</span>

    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">r2</span> <span class="o">&gt;</span> <span class="n">best_r2</span><span class="p">:</span>
        <span class="n">best_r2</span> <span class="o">=</span> <span class="n">r2</span>
        <span class="n">best_n_estimators</span> <span class="o">=</span> <span class="n">n_estimators</span>
        <span class="n">best_max_depth</span> <span class="o">=</span> <span class="n">max_depth</span>
        <span class="n">best_min_samples_split</span> <span class="o">=</span> <span class="n">min_samples_split</span>
        <span class="n">best_min_samples_leaf</span> <span class="o">=</span> <span class="n">min_samples_leaf</span>
        <span class="n">best_rmse</span> <span class="o">=</span> <span class="n">rmse</span>

    <span class="n">r2_val</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">n_estimators</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">rmse</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mejor R²: </span><span class="si">{</span><span class="n">best_r2</span><span class="si">}</span><span class="s2">, Mejor n_estimators: </span><span class="si">{</span><span class="n">best_n_estimators</span><span class="si">}</span><span class="s2">, Mejor max_depth: </span><span class="si">{</span><span class="n">best_max_depth</span><span class="si">}</span><span class="s2"> RMSE: </span><span class="si">{</span><span class="n">best_rmse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mejor R²: 0.6775478891519091, Mejor n_estimators: 10, Mejor max_depth: 10 RMSE: 0.49853228876142575
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ranfor</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span> <span class="mi">10</span><span class="p">,</span><span class="n">max_depth</span><span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>

<span class="n">ranfor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">ypredranfor</span> <span class="o">=</span> <span class="n">ranfor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">ranfor</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8112085676225407
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mseranfor</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredranfor</span><span class="p">)</span>
<span class="n">rmseranfor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mseranfor</span><span class="p">)</span>
<span class="n">maperanfor</span> <span class="o">=</span> <span class="n">MAPE</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredranfor</span><span class="p">)</span>
<span class="n">maeranfor</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredranfor</span><span class="p">)</span>
<span class="n">r2ranfor</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredranfor</span><span class="p">)</span>
<span class="n">ljungboxranfor</span><span class="p">,</span> <span class="n">jarquebreranfor</span> <span class="o">=</span> <span class="n">residuos</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredranfor</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valoresranfor</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;RANDOM FOREST&#39;</span><span class="p">],</span><span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mseranfor</span><span class="p">],</span><span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmseranfor</span><span class="p">],</span><span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">maperanfor</span><span class="p">],</span><span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">maeranfor</span><span class="p">],</span><span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2ranfor</span><span class="p">],</span><span class="s1">&#39;Ljung-Box p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ljungboxranfor</span><span class="p">],</span><span class="s1">&#39;Jarque-Bera p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">jarquebreranfor</span><span class="p">]}</span>
<span class="n">cuadro5</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">valoresranfor</span><span class="p">)</span>
<span class="n">cuadro5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>MAE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>RANDOM FOREST</td>
      <td>0.417216</td>
      <td>0.645923</td>
      <td>14.062093</td>
      <td>0.530821</td>
      <td>0.811209</td>
      <td>0.258883</td>
      <td>0.954305</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>El modelo <strong>random forest</strong> presenta un <strong>MSE</strong> de 0.417216 y un <strong>RMSE</strong> de 0.645923, lo que indica un error moderado en las predicciones. Con un <strong>R²</strong> de 0.811209, el modelo explica aproximadamente el 81.12% de la variabilidad de los datos, lo que sugiere un buen ajuste. Los <strong>p-valores</strong> de las pruebas de Ljung-Box (0.258883) y Jarque-Bera (0.954305) indican que no hay evidencia significativa de autocorrelación ni de no normalidad en los residuos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ypred</span> <span class="o">=</span> <span class="n">ranfor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">ypredtrain</span> <span class="o">=</span> <span class="n">ranfor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">)</span>
<span class="n">graph_predictions</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">ypredtrain</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;Random forest&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/949077cc0bce6632260d82adc39ff9fd47e4b496050e7cca85b2ade3efd1dad6.png" src="_images/949077cc0bce6632260d82adc39ff9fd47e4b496050e7cca85b2ade3efd1dad6.png" />
</div>
</div>
<p>Se observa un buen ajuste general tanto en entrenamiento con en prueba. Las predicciones asociadas a valores máximos en prueba están bien realizadas.</p>
</section>
<section id="id7">
<h3><strong>Hiperparametrización para XGBoost</strong><a class="headerlink" href="#id7" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r2_val</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">best_r2</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
<span class="n">best_n_estimators</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_max_depth</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_learning_rate</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_subsample</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_colsample_bytree</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_min_child_weight</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_gamma</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># 9600</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
    <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span>
    <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">ParameterGrid</span><span class="p">(</span><span class="n">param_grid</span><span class="p">):</span>
    <span class="n">n_estimators</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">]</span>
    <span class="n">max_depth</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;max_depth&#39;</span><span class="p">]</span>
    <span class="n">learning_rate</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">]</span>
    <span class="n">xgb</span> <span class="o">=</span> <span class="n">XGBRegressor</span><span class="p">(</span>
        <span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
        <span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span>
    <span class="p">)</span>

    <span class="n">xgb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_val</span><span class="p">)</span>

    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">r2</span> <span class="o">&gt;</span> <span class="n">best_r2</span><span class="p">:</span>
        <span class="n">best_r2</span> <span class="o">=</span> <span class="n">r2</span>
        <span class="n">best_n_estimators</span> <span class="o">=</span> <span class="n">n_estimators</span>
        <span class="n">best_max_depth</span> <span class="o">=</span> <span class="n">max_depth</span>
        <span class="n">best_learning_rate</span> <span class="o">=</span> <span class="n">learning_rate</span>

    <span class="n">r2_val</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">n_estimators</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">,</span> <span class="n">learning_rate</span><span class="p">,</span> <span class="n">r2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best R²: </span><span class="si">{</span><span class="n">best_r2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best n_estimators: </span><span class="si">{</span><span class="n">best_n_estimators</span><span class="si">}</span><span class="s2">, Best max_depth: </span><span class="si">{</span><span class="n">best_max_depth</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best learning_rate: </span><span class="si">{</span><span class="n">best_learning_rate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best R²: 0.6816921650612373
Best n_estimators: 30, Best max_depth: 9
Best learning_rate: 0.1
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xgboost</span> <span class="o">=</span> <span class="n">XGBRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span> <span class="mi">30</span><span class="p">,</span><span class="n">max_depth</span><span class="o">=</span> <span class="mi">9</span><span class="p">,</span> <span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span>

<span class="n">xgboost</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">ypredxgboost</span> <span class="o">=</span> <span class="n">xgboost</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">xgboost</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8061108705349451
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msexgboost</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredxgboost</span><span class="p">)</span>
<span class="n">rmsexgboost</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">msexgboost</span><span class="p">)</span>
<span class="n">mapexgboost</span> <span class="o">=</span> <span class="n">MAPE</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredxgboost</span><span class="p">)</span>
<span class="n">maexgboost</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredxgboost</span><span class="p">)</span>
<span class="n">r2xgboost</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredxgboost</span><span class="p">)</span>
<span class="n">ljungboxxgboost</span><span class="p">,</span> <span class="n">jarquebarexgboost</span> <span class="o">=</span> <span class="n">residuos</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredxgboost</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valoresxgboost</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;XGBOOST&#39;</span><span class="p">],</span><span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">msexgboost</span><span class="p">],</span><span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmsexgboost</span><span class="p">],</span><span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mapexgboost</span><span class="p">],</span><span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">maexgboost</span><span class="p">],</span><span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2xgboost</span><span class="p">],</span><span class="s1">&#39;Ljung-Box p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ljungboxxgboost</span><span class="p">],</span><span class="s1">&#39;Jarque-Bera p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">jarquebarexgboost</span><span class="p">]}</span>
<span class="n">cuadro6</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">valoresxgboost</span><span class="p">)</span>
<span class="n">cuadro6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>MAE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>XGBOOST</td>
      <td>0.428482</td>
      <td>0.654585</td>
      <td>14.14237</td>
      <td>0.538287</td>
      <td>0.806111</td>
      <td>0.203712</td>
      <td>0.975059</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>El modelo <strong>XGBoost</strong> presenta un <strong>MSE</strong> de 0.428482 y un <strong>RMSE</strong> de 0.654585, lo que indica errores moderados en las predicciones. Con un <strong>R²</strong> de 0.806111, el modelo explica aproximadamente el 80.61% de la variabilidad de los datos, lo que sugiere un buen ajuste. Los <strong>p-valores</strong> de las pruebas de Ljung-Box (0.203712) y Jarque-Bera (0.975059) indican que no hay evidencia significativa de autocorrelación ni de no normalidad en los residuos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ypred</span> <span class="o">=</span> <span class="n">xgboost</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">ypredtrain</span> <span class="o">=</span> <span class="n">xgboost</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">)</span>
<span class="n">graph_predictions</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">ypredtrain</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;XGBoost&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/daf0945e86554e5a2712128a9ce1a9f018338134a702ebdbe0ee84ffa1179af0.png" src="_images/daf0945e86554e5a2712128a9ce1a9f018338134a702ebdbe0ee84ffa1179af0.png" />
</div>
</div>
<p>Se observa buen ajuste general en el modelo tanto en entrenamiento como en prueba, ya esperado debido a las metricas arrojadas en test. Nuevamente, predice mejor valores altos, peroo aún así parece tener problemas.</p>
</section>
<section id="id8">
<h3><strong>Hiperparametrización para SVR</strong><a class="headerlink" href="#id8" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">r2_val</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">best_r2</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
<span class="n">best_C</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_kernel</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_gamma</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_epsilon</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_tol</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_degree</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">for</span> <span class="n">C</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">kernel</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="s2">&quot;rbf&quot;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">gamma</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;auto&quot;</span><span class="p">]:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>
                        <span class="n">svr</span> <span class="o">=</span> <span class="n">SVR</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">)</span>

                        <span class="n">svr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

                        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">svr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_val</span><span class="p">)</span>

                        <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">r2</span> <span class="o">&gt;</span> <span class="n">best_r2</span><span class="p">:</span>
                            <span class="n">best_r2</span> <span class="o">=</span> <span class="n">r2</span>
                            <span class="n">best_C</span> <span class="o">=</span> <span class="n">C</span>
                            <span class="n">best_kernel</span> <span class="o">=</span> <span class="n">kernel</span>
                            <span class="n">best_gamma</span> <span class="o">=</span> <span class="n">gamma</span>

                        <span class="n">r2_val</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">C</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">r2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best R²: </span><span class="si">{</span><span class="n">best_r2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best C: </span><span class="si">{</span><span class="n">best_C</span><span class="si">}</span><span class="s2">, Best kernel: </span><span class="si">{</span><span class="n">best_kernel</span><span class="si">}</span><span class="s2">, Best gamma: </span><span class="si">{</span><span class="n">best_gamma</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">svr</span> <span class="o">=</span> <span class="n">SVR</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="s1">&#39;scale&#39;</span><span class="p">)</span>

<span class="n">svr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">ypredsvr</span> <span class="o">=</span> <span class="n">svr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">svr</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8190864988915199
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">msesvr</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredsvr</span><span class="p">)</span>
<span class="n">rmsesvr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">msesvr</span><span class="p">)</span>
<span class="n">mapesvr</span> <span class="o">=</span><span class="n">MAPE</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">ypredsvr</span><span class="p">)</span>
<span class="n">maesvr</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredsvr</span><span class="p">)</span>
<span class="n">r2svr</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredsvr</span><span class="p">)</span>
<span class="n">ljungboxsvr</span><span class="p">,</span> <span class="n">jarquebaresvr</span> <span class="o">=</span> <span class="n">residuos</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ypredsvr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valoressvr</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;SVR&#39;</span><span class="p">],</span><span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">msesvr</span><span class="p">],</span><span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmsesvr</span><span class="p">],</span><span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">mapesvr</span><span class="p">],</span><span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">maesvr</span><span class="p">],</span><span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">r2svr</span><span class="p">],</span><span class="s1">&#39;Ljung-Box p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">ljungboxsvr</span><span class="p">],</span><span class="s1">&#39;Jarque-Bera p-value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">jarquebaresvr</span><span class="p">]}</span>
<span class="n">cuadro7</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">valoressvr</span><span class="p">)</span>
<span class="n">cuadro7</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>MAE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SVR</td>
      <td>0.399806</td>
      <td>0.632302</td>
      <td>13.569693</td>
      <td>0.512612</td>
      <td>0.819086</td>
      <td>0.30878</td>
      <td>0.940227</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>El modelo <strong>SVR</strong> presenta un <strong>MSE</strong> de 0.399806 y un <strong>RMSE</strong> de 0.632302, lo que indica un error moderado en las predicciones. Con un <strong>R²</strong> de 0.819086, el modelo explica aproximadamente el 81.91% de la variabilidad de los datos, lo que sugiere un buen ajuste. Los <strong>p-valores</strong> de las pruebas de Ljung-Box (0.30878) y Jarque-Bera (0.940227) indican que no hay evidencia significativa de autocorrelación ni de no normalidad en los residuos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ypred</span> <span class="o">=</span> <span class="n">svr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">ypredtrain</span> <span class="o">=</span> <span class="n">svr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">)</span>
<span class="n">graph_predictions</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">ypredtrain</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">ypred</span><span class="p">,</span> <span class="s1">&#39;SVR&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/13e532d6255dbd58dd3e67b8c591b1d7664fdc01e03e36e12a7d4c401f4d1a78.png" src="_images/13e532d6255dbd58dd3e67b8c591b1d7664fdc01e03e36e12a7d4c401f4d1a78.png" />
</div>
</div>
<p>Presenta un buen ajuste en ambos conjuntos de datos, ligeramente mejor en prueba. Presenta el mismo inconveniente de la predicción del valor extremo pero es mejor que otros modelos.</p>
</section>
<section id="id9">
<h3><strong>Resultados generales</strong><a class="headerlink" href="#id9" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cuadro9</span> <span class="o">=</span> <span class="p">[</span><span class="n">cuadro1</span><span class="p">,</span> <span class="n">cuadro2</span><span class="p">,</span> <span class="n">cuadro3</span><span class="p">,</span> <span class="n">cuadro4</span><span class="p">,</span> <span class="n">cuadro5</span><span class="p">,</span> <span class="n">cuadro6</span><span class="p">,</span> <span class="n">cuadro7</span><span class="p">,</span> <span class="n">cuadro8</span><span class="p">]</span>
<span class="n">cuadro9</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">cuadro9</span><span class="p">)</span>
<span class="n">cuadro9</span> <span class="o">=</span> <span class="n">cuadro9</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">cuadro9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>MAE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>KNN</td>
      <td>0.335990</td>
      <td>0.579647</td>
      <td>13.482857</td>
      <td>0.488480</td>
      <td>0.847963</td>
      <td>0.466765</td>
      <td>0.605240</td>
    </tr>
    <tr>
      <th>0</th>
      <td>SVR</td>
      <td>0.399806</td>
      <td>0.632302</td>
      <td>13.569693</td>
      <td>0.512612</td>
      <td>0.819086</td>
      <td>0.308780</td>
      <td>0.940227</td>
    </tr>
    <tr>
      <th>0</th>
      <td>DEC. TREE</td>
      <td>0.411925</td>
      <td>0.641814</td>
      <td>13.792041</td>
      <td>0.499719</td>
      <td>0.813603</td>
      <td>0.400202</td>
      <td>0.397399</td>
    </tr>
    <tr>
      <th>0</th>
      <td>RANDOM FOREST</td>
      <td>0.417216</td>
      <td>0.645923</td>
      <td>14.062093</td>
      <td>0.530821</td>
      <td>0.811209</td>
      <td>0.258883</td>
      <td>0.954305</td>
    </tr>
    <tr>
      <th>0</th>
      <td>XGBOOST</td>
      <td>0.428482</td>
      <td>0.654585</td>
      <td>14.142370</td>
      <td>0.538287</td>
      <td>0.806111</td>
      <td>0.203712</td>
      <td>0.975059</td>
    </tr>
    <tr>
      <th>0</th>
      <td>LASSO</td>
      <td>0.436542</td>
      <td>0.660713</td>
      <td>14.735133</td>
      <td>0.549878</td>
      <td>0.802463</td>
      <td>0.319511</td>
      <td>0.929675</td>
    </tr>
    <tr>
      <th>0</th>
      <td>REG. LINEAL</td>
      <td>0.447220</td>
      <td>0.668745</td>
      <td>14.696839</td>
      <td>0.552116</td>
      <td>0.797632</td>
      <td>0.300747</td>
      <td>0.938138</td>
    </tr>
    <tr>
      <th>0</th>
      <td>RIDGE</td>
      <td>0.448381</td>
      <td>0.669613</td>
      <td>14.718895</td>
      <td>0.552965</td>
      <td>0.797106</td>
      <td>0.299967</td>
      <td>0.937912</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Los modelos evaluados corresponden a <strong>meta learners</strong> con cuatro <strong>base learners</strong> y presentan un desempeño variado en términos de precisión, ajuste y comportamiento de los residuos.</p>
<p>El modelo <strong>KNN</strong> tiene un <strong>MSE</strong> de 0.335990 y un <strong>RMSE</strong> de 0.579647, indicando un buen ajuste general, con un <strong>R²</strong> alto de 0.847963. Aunque el <strong>MAPE</strong> es de 13.48%, la prueba de <strong>Jarque-Bera</strong> (0.605240) sugiere que los residuos siguen una distribución cercana a la normal. Este modelo muestra un buen equilibrio entre precisión y estabilidad de residuos.</p>
<p>Por su parte, <strong>SVR</strong> tiene un <strong>MSE</strong> de 0.399806 y un <strong>RMSE</strong> de 0.632302, lo que indica una ligera mayor imprecisión comparado con <strong>KNN</strong>. Su <strong>R²</strong> de 0.819086 es aún alto, y las pruebas de residuos (<strong>Ljung-Box</strong> y <strong>Jarque-Bera</strong>) muestran que no hay autocorrelación ni problemas de normalidad en los residuos, lo que refuerza la estabilidad del modelo.</p>
<p>El modelo <strong>Decision tree</strong> tiene un <strong>MSE</strong> de 0.411925, un <strong>RMSE</strong> de 0.641814 y un <strong>R²</strong> de 0.813603. Aunque sus resultados son buenos, su desempeño es ligeramente inferior en comparación con <strong>KNN</strong> y <strong>SVR</strong>. Sin embargo, las pruebas estadísticas sugieren estabilidad en los residuos, sin evidencias significativas de autocorrelación ni no-normalidad.</p>
<p><strong>Random Forest</strong> presenta un <strong>MSE</strong> de 0.417216 y un <strong>RMSE</strong> de 0.645923. Su <strong>R²</strong> es de 0.811209, lo que indica una capacidad moderada para capturar la variabilidad de los datos. A pesar de tener un desempeño similar al de <strong>Decision tree</strong>, <strong>random forest</strong> muestra mejores resultados en términos de las pruebas de residuos, con un p-valor alto en <strong>Jarque-Bera</strong> (0.954305), lo que sugiere normalidad en los residuos.</p>
<p><strong>XGBoost</strong>, con un <strong>MSE</strong> de 0.428482 y un <strong>RMSE</strong> de 0.654585, tiene un <strong>R²</strong> de 0.806111, lo que lo hace adecuado, aunque ligeramente inferior a los modelos anteriores. Las pruebas de residuos indican que no hay autocorrelación ni problemas de normalidad, pero sus resultados son menos robustos en comparación con otros modelos.</p>
<p>En cuanto a los modelos lineales, <strong>lasso</strong>, <strong>regresión lineal</strong> y <strong>ridge</strong> tienen un <strong>MSE</strong> y <strong>RMSE</strong> más altos en comparación con los modelos no lineales. <strong>LAsso</strong> tiene un <strong>R²</strong> de 0.802463, <strong>Regresión lineal</strong> de 0.797632, y <strong>Ridge</strong> de 0.797106, lo que indica que estos modelos tienen un ajuste razonable pero menor capacidad predictiva que los modelos no lineales. Sin embargo, sus pruebas de residuos (<strong>Jarque-Bera</strong>) también muestran estabilidad.</p>
<p>En resumen, los modelos no lineales (<strong>KNN</strong>, <strong>SVR</strong>, <strong>Decision Tree</strong>, <strong>Random Forest</strong>, <strong>XGBoost</strong>) tienden a ofrecer un mejor desempeño en términos de ajuste y precisión, mientras que los modelos lineales (<strong>Lasso</strong>, <strong>Regresión Lineal</strong>, <strong>Ridge</strong>) tienen un ajuste algo más limitado, a pesar de ser tres de los cuatro base learners utilizados, pero presentan residuos estables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stacking_4bl</span> <span class="o">=</span> <span class="n">cuadro9</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="comparacion-de-base-learners-y-meta-learners-con-4-y-3-base-learners">
<h2><strong>Comparación de base learners y meta learners con 4 y 3 base learners</strong><a class="headerlink" href="#comparacion-de-base-learners-y-meta-learners-con-4-y-3-base-learners" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modelosbases</span><span class="p">[</span><span class="s1">&#39;Base learners&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;No aplica&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modelosbases</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>MAE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
      <th>Base learners</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>REG. LINEAL</td>
      <td>0.358341</td>
      <td>0.598616</td>
      <td>15.739528</td>
      <td>0.541310</td>
      <td>0.837850</td>
      <td>0.192736</td>
      <td>0.095363</td>
      <td>No aplica</td>
    </tr>
    <tr>
      <th>0</th>
      <td>RIDGE</td>
      <td>0.358581</td>
      <td>0.598816</td>
      <td>15.746817</td>
      <td>0.541537</td>
      <td>0.837741</td>
      <td>0.192629</td>
      <td>0.095406</td>
      <td>No aplica</td>
    </tr>
    <tr>
      <th>0</th>
      <td>SVR</td>
      <td>0.362467</td>
      <td>0.602052</td>
      <td>15.125073</td>
      <td>0.508772</td>
      <td>0.835983</td>
      <td>0.015236</td>
      <td>0.148630</td>
      <td>No aplica</td>
    </tr>
    <tr>
      <th>0</th>
      <td>LASSO</td>
      <td>0.468375</td>
      <td>0.684379</td>
      <td>15.627265</td>
      <td>0.586556</td>
      <td>0.788059</td>
      <td>0.284742</td>
      <td>0.050258</td>
      <td>No aplica</td>
    </tr>
    <tr>
      <th>0</th>
      <td>XGBOOST</td>
      <td>0.471152</td>
      <td>0.686405</td>
      <td>14.995415</td>
      <td>0.572242</td>
      <td>0.786802</td>
      <td>0.236152</td>
      <td>0.910029</td>
      <td>No aplica</td>
    </tr>
    <tr>
      <th>0</th>
      <td>RANDOM FOREST</td>
      <td>0.517051</td>
      <td>0.719063</td>
      <td>16.628608</td>
      <td>0.621354</td>
      <td>0.766033</td>
      <td>0.344430</td>
      <td>0.697858</td>
      <td>No aplica</td>
    </tr>
    <tr>
      <th>0</th>
      <td>DEC. TREE</td>
      <td>0.600514</td>
      <td>0.774928</td>
      <td>17.311127</td>
      <td>0.619180</td>
      <td>0.728266</td>
      <td>0.692234</td>
      <td>0.204984</td>
      <td>No aplica</td>
    </tr>
    <tr>
      <th>0</th>
      <td>KNN</td>
      <td>0.996620</td>
      <td>0.998308</td>
      <td>21.163538</td>
      <td>0.863542</td>
      <td>0.549027</td>
      <td>0.074711</td>
      <td>0.380957</td>
      <td>No aplica</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stacking_4bl</span><span class="p">[</span><span class="s1">&#39;Base learners&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;4&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stacking_4bl</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>MAE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
      <th>Base learners</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>KNN</td>
      <td>0.335990</td>
      <td>0.579647</td>
      <td>13.482857</td>
      <td>0.488480</td>
      <td>0.847963</td>
      <td>0.466765</td>
      <td>0.605240</td>
      <td>4</td>
    </tr>
    <tr>
      <th>0</th>
      <td>SVR</td>
      <td>0.399806</td>
      <td>0.632302</td>
      <td>13.569693</td>
      <td>0.512612</td>
      <td>0.819086</td>
      <td>0.308780</td>
      <td>0.940227</td>
      <td>4</td>
    </tr>
    <tr>
      <th>0</th>
      <td>DEC. TREE</td>
      <td>0.411925</td>
      <td>0.641814</td>
      <td>13.792041</td>
      <td>0.499719</td>
      <td>0.813603</td>
      <td>0.400202</td>
      <td>0.397399</td>
      <td>4</td>
    </tr>
    <tr>
      <th>0</th>
      <td>RANDOM FOREST</td>
      <td>0.417216</td>
      <td>0.645923</td>
      <td>14.062093</td>
      <td>0.530821</td>
      <td>0.811209</td>
      <td>0.258883</td>
      <td>0.954305</td>
      <td>4</td>
    </tr>
    <tr>
      <th>0</th>
      <td>XGBOOST</td>
      <td>0.428482</td>
      <td>0.654585</td>
      <td>14.142370</td>
      <td>0.538287</td>
      <td>0.806111</td>
      <td>0.203712</td>
      <td>0.975059</td>
      <td>4</td>
    </tr>
    <tr>
      <th>0</th>
      <td>LASSO</td>
      <td>0.436542</td>
      <td>0.660713</td>
      <td>14.735133</td>
      <td>0.549878</td>
      <td>0.802463</td>
      <td>0.319511</td>
      <td>0.929675</td>
      <td>4</td>
    </tr>
    <tr>
      <th>0</th>
      <td>REG. LINEAL</td>
      <td>0.447220</td>
      <td>0.668745</td>
      <td>14.696839</td>
      <td>0.552116</td>
      <td>0.797632</td>
      <td>0.300747</td>
      <td>0.938138</td>
      <td>4</td>
    </tr>
    <tr>
      <th>0</th>
      <td>RIDGE</td>
      <td>0.448381</td>
      <td>0.669613</td>
      <td>14.718895</td>
      <td>0.552965</td>
      <td>0.797106</td>
      <td>0.299967</td>
      <td>0.937912</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stacking_3bl</span><span class="p">[</span><span class="s1">&#39;Base learners&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;3&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stacking_3bl</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>MAE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
      <th>Base learners</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SVR</td>
      <td>0.323547</td>
      <td>0.568812</td>
      <td>14.558665</td>
      <td>0.501322</td>
      <td>0.853594</td>
      <td>0.124485</td>
      <td>0.098749</td>
      <td>3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>RIDGE</td>
      <td>0.358260</td>
      <td>0.598549</td>
      <td>15.737396</td>
      <td>0.541237</td>
      <td>0.837886</td>
      <td>0.192711</td>
      <td>0.095328</td>
      <td>3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>REG. LINEAL</td>
      <td>0.358341</td>
      <td>0.598616</td>
      <td>15.739528</td>
      <td>0.541310</td>
      <td>0.837850</td>
      <td>0.192736</td>
      <td>0.095363</td>
      <td>3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>LASSO</td>
      <td>0.359584</td>
      <td>0.599653</td>
      <td>15.701460</td>
      <td>0.541523</td>
      <td>0.837287</td>
      <td>0.219253</td>
      <td>0.092174</td>
      <td>3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>XGBOOST</td>
      <td>0.529450</td>
      <td>0.727633</td>
      <td>16.132808</td>
      <td>0.573133</td>
      <td>0.760422</td>
      <td>0.751574</td>
      <td>0.282879</td>
      <td>3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>KNN</td>
      <td>0.536753</td>
      <td>0.732634</td>
      <td>16.370041</td>
      <td>0.607353</td>
      <td>0.757118</td>
      <td>0.104821</td>
      <td>0.208181</td>
      <td>3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>RANDOM FOREST</td>
      <td>0.591450</td>
      <td>0.769058</td>
      <td>17.172687</td>
      <td>0.652494</td>
      <td>0.732367</td>
      <td>0.056950</td>
      <td>0.055058</td>
      <td>3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>DEC. TREE</td>
      <td>0.731780</td>
      <td>0.855441</td>
      <td>17.899770</td>
      <td>0.685697</td>
      <td>0.668867</td>
      <td>0.002836</td>
      <td>0.489894</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados_finales</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">modelosbases</span><span class="p">,</span> <span class="n">stacking_4bl</span><span class="p">,</span> <span class="n">stacking_3bl</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados_finales</span> <span class="o">=</span> <span class="n">resultados_finales</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">resultados_finales</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>MAE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
      <th>Base learners</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SVR</td>
      <td>0.323547</td>
      <td>0.568812</td>
      <td>14.558665</td>
      <td>0.501322</td>
      <td>0.853594</td>
      <td>0.124485</td>
      <td>0.098749</td>
      <td>3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>KNN</td>
      <td>0.335990</td>
      <td>0.579647</td>
      <td>13.482857</td>
      <td>0.488480</td>
      <td>0.847963</td>
      <td>0.466765</td>
      <td>0.605240</td>
      <td>4</td>
    </tr>
    <tr>
      <th>0</th>
      <td>RIDGE</td>
      <td>0.358260</td>
      <td>0.598549</td>
      <td>15.737396</td>
      <td>0.541237</td>
      <td>0.837886</td>
      <td>0.192711</td>
      <td>0.095328</td>
      <td>3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>REG. LINEAL</td>
      <td>0.358341</td>
      <td>0.598616</td>
      <td>15.739528</td>
      <td>0.541310</td>
      <td>0.837850</td>
      <td>0.192736</td>
      <td>0.095363</td>
      <td>No aplica</td>
    </tr>
    <tr>
      <th>0</th>
      <td>REG. LINEAL</td>
      <td>0.358341</td>
      <td>0.598616</td>
      <td>15.739528</td>
      <td>0.541310</td>
      <td>0.837850</td>
      <td>0.192736</td>
      <td>0.095363</td>
      <td>3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>RIDGE</td>
      <td>0.358581</td>
      <td>0.598816</td>
      <td>15.746817</td>
      <td>0.541537</td>
      <td>0.837741</td>
      <td>0.192629</td>
      <td>0.095406</td>
      <td>No aplica</td>
    </tr>
    <tr>
      <th>0</th>
      <td>LASSO</td>
      <td>0.359584</td>
      <td>0.599653</td>
      <td>15.701460</td>
      <td>0.541523</td>
      <td>0.837287</td>
      <td>0.219253</td>
      <td>0.092174</td>
      <td>3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>SVR</td>
      <td>0.362467</td>
      <td>0.602052</td>
      <td>15.125073</td>
      <td>0.508772</td>
      <td>0.835983</td>
      <td>0.015236</td>
      <td>0.148630</td>
      <td>No aplica</td>
    </tr>
    <tr>
      <th>0</th>
      <td>SVR</td>
      <td>0.399806</td>
      <td>0.632302</td>
      <td>13.569693</td>
      <td>0.512612</td>
      <td>0.819086</td>
      <td>0.308780</td>
      <td>0.940227</td>
      <td>4</td>
    </tr>
    <tr>
      <th>0</th>
      <td>DEC. TREE</td>
      <td>0.411925</td>
      <td>0.641814</td>
      <td>13.792041</td>
      <td>0.499719</td>
      <td>0.813603</td>
      <td>0.400202</td>
      <td>0.397399</td>
      <td>4</td>
    </tr>
    <tr>
      <th>0</th>
      <td>RANDOM FOREST</td>
      <td>0.417216</td>
      <td>0.645923</td>
      <td>14.062093</td>
      <td>0.530821</td>
      <td>0.811209</td>
      <td>0.258883</td>
      <td>0.954305</td>
      <td>4</td>
    </tr>
    <tr>
      <th>0</th>
      <td>XGBOOST</td>
      <td>0.428482</td>
      <td>0.654585</td>
      <td>14.142370</td>
      <td>0.538287</td>
      <td>0.806111</td>
      <td>0.203712</td>
      <td>0.975059</td>
      <td>4</td>
    </tr>
    <tr>
      <th>0</th>
      <td>LASSO</td>
      <td>0.436542</td>
      <td>0.660713</td>
      <td>14.735133</td>
      <td>0.549878</td>
      <td>0.802463</td>
      <td>0.319511</td>
      <td>0.929675</td>
      <td>4</td>
    </tr>
    <tr>
      <th>0</th>
      <td>REG. LINEAL</td>
      <td>0.447220</td>
      <td>0.668745</td>
      <td>14.696839</td>
      <td>0.552116</td>
      <td>0.797632</td>
      <td>0.300747</td>
      <td>0.938138</td>
      <td>4</td>
    </tr>
    <tr>
      <th>0</th>
      <td>RIDGE</td>
      <td>0.448381</td>
      <td>0.669613</td>
      <td>14.718895</td>
      <td>0.552965</td>
      <td>0.797106</td>
      <td>0.299967</td>
      <td>0.937912</td>
      <td>4</td>
    </tr>
    <tr>
      <th>0</th>
      <td>LASSO</td>
      <td>0.468375</td>
      <td>0.684379</td>
      <td>15.627265</td>
      <td>0.586556</td>
      <td>0.788059</td>
      <td>0.284742</td>
      <td>0.050258</td>
      <td>No aplica</td>
    </tr>
    <tr>
      <th>0</th>
      <td>XGBOOST</td>
      <td>0.471152</td>
      <td>0.686405</td>
      <td>14.995415</td>
      <td>0.572242</td>
      <td>0.786802</td>
      <td>0.236152</td>
      <td>0.910029</td>
      <td>No aplica</td>
    </tr>
    <tr>
      <th>0</th>
      <td>RANDOM FOREST</td>
      <td>0.517051</td>
      <td>0.719063</td>
      <td>16.628608</td>
      <td>0.621354</td>
      <td>0.766033</td>
      <td>0.344430</td>
      <td>0.697858</td>
      <td>No aplica</td>
    </tr>
    <tr>
      <th>0</th>
      <td>XGBOOST</td>
      <td>0.529450</td>
      <td>0.727633</td>
      <td>16.132808</td>
      <td>0.573133</td>
      <td>0.760422</td>
      <td>0.751574</td>
      <td>0.282879</td>
      <td>3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>KNN</td>
      <td>0.536753</td>
      <td>0.732634</td>
      <td>16.370041</td>
      <td>0.607353</td>
      <td>0.757118</td>
      <td>0.104821</td>
      <td>0.208181</td>
      <td>3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>RANDOM FOREST</td>
      <td>0.591450</td>
      <td>0.769058</td>
      <td>17.172687</td>
      <td>0.652494</td>
      <td>0.732367</td>
      <td>0.056950</td>
      <td>0.055058</td>
      <td>3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>DEC. TREE</td>
      <td>0.600514</td>
      <td>0.774928</td>
      <td>17.311127</td>
      <td>0.619180</td>
      <td>0.728266</td>
      <td>0.692234</td>
      <td>0.204984</td>
      <td>No aplica</td>
    </tr>
    <tr>
      <th>0</th>
      <td>DEC. TREE</td>
      <td>0.731780</td>
      <td>0.855441</td>
      <td>17.899770</td>
      <td>0.685697</td>
      <td>0.668867</td>
      <td>0.002836</td>
      <td>0.489894</td>
      <td>3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>KNN</td>
      <td>0.996620</td>
      <td>0.998308</td>
      <td>21.163538</td>
      <td>0.863542</td>
      <td>0.549027</td>
      <td>0.074711</td>
      <td>0.380957</td>
      <td>No aplica</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Estos representan los 24 modelos realizados, incluyendo los modelos bases (sin utilizar metalearners) y los modelos que utilizan stacking con 3 y 4 base learners. Se observa que los tres modelos obtenidos para la predicción del viento corresponden a modelos ensamblados utilizando, en primer lugar, 3 base learners con un SVR como metalearner, en segundo lugar KNN como metalerner utilizando cuatro base learners y en tercer lugar ridge con 3 base learners.</p>
<p>Se aprecian también que no hubo una mejoría entre regresión lineal base o utilizándola como metalearner que utilizándolo con tres base learners, a diferencia de otros base learners involucrados usados como metalearners como es el caso de Ridge, Lasoo y XGBoost.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Dado los resultados obtenidos, se elige SVR como metalearner con 3 base learners como el modelo propuesto que mejora la predicción del viento horaria, es decir, el flujo general trabajado durante este proyecto culmina de la siguiente manera:</p>
</div>
<p><img alt="" src="assets/finalml.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados_finales</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MSE</th>
      <th>RMSE</th>
      <th>MAPE</th>
      <th>MAE</th>
      <th>R2</th>
      <th>Ljung-Box p-value</th>
      <th>Jarque-Bera p-value</th>
      <th>Base learners</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SVR</td>
      <td>0.323547</td>
      <td>0.568812</td>
      <td>14.558665</td>
      <td>0.501322</td>
      <td>0.853594</td>
      <td>0.124485</td>
      <td>0.098749</td>
      <td>3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>REG. LINEAL</td>
      <td>0.358341</td>
      <td>0.598616</td>
      <td>15.739528</td>
      <td>0.541310</td>
      <td>0.837850</td>
      <td>0.192736</td>
      <td>0.095363</td>
      <td>No aplica</td>
    </tr>
    <tr>
      <th>0</th>
      <td>RIDGE</td>
      <td>0.358581</td>
      <td>0.598816</td>
      <td>15.746817</td>
      <td>0.541537</td>
      <td>0.837741</td>
      <td>0.192629</td>
      <td>0.095406</td>
      <td>No aplica</td>
    </tr>
    <tr>
      <th>0</th>
      <td>LASSO</td>
      <td>0.468375</td>
      <td>0.684379</td>
      <td>15.627265</td>
      <td>0.586556</td>
      <td>0.788059</td>
      <td>0.284742</td>
      <td>0.050258</td>
      <td>No aplica</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>El modelo <strong>SVR</strong> como metalearner utilizando los base learners mostrados en la tabla, muestra un rendimiento superior en comparación con los modelos base learners (<strong>Regresión lineal</strong>, <strong>Ridge</strong>, <strong>Lasso</strong>) en términos de <strong>MSE</strong>, <strong>RMSE</strong> y <strong>MAPE</strong>. Con un <strong>MSE</strong> de 0.323547 y un <strong>RMSE</strong> de 0.568812, <strong>SVR</strong> presenta menores errores en las predicciones en comparación con los modelos lineales, cuyos valores de <strong>MSE</strong> y <strong>RMSE</strong> son más altos (0.358341 y 0.358581 para <strong>REG. LINEAL</strong> y <strong>RIDGE</strong>, respectivamente). En cuanto al <strong>MAPE</strong>, <strong>SVR</strong> también supera a los modelos base con un 14.56%, mientras que <strong>Regresión lineal</strong>, <strong>Ridge</strong> y <strong>Lasso</strong> tienen valores superiores (15.74%, 15.75% y 15.63%, respectivamente). Esto sugiere que <strong>SVR</strong> es más preciso y consistente en sus predicciones en comparación con los modelos lineales, que presentan un ajuste ligeramente peor. Sin embargo, <strong>Lasso</strong> es el que muestra el peor desempeño, con los valores más altos en <strong>MSE</strong>, <strong>RMSE</strong> y <strong>MAPE</strong>.</p>
<p>En este caso, el <strong>SVR</strong> ha mostrado un mejor desempeño general que los base learners en términos de <strong>MSE</strong>, <strong>RMSE</strong>, y <strong>MAPE</strong>, lo cual sugiere que el ensamblaje con <strong>stacking</strong> ha mejorado la capacidad predictiva al combinar de manera efectiva los distintos enfoques de los modelos base. Es decir, el ensamblaje con <strong>stacking</strong> funcionó, ya que <strong>SVR</strong> como meta-learner ha superado a los modelos base, lo que indica que la técnica logró optimizar el rendimiento general del modelo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ypredtrain</span> <span class="o">=</span> <span class="n">svr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_train</span><span class="p">)</span>
<span class="n">ypred</span> <span class="o">=</span> <span class="n">svr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_test</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">svr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xp_val</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span> <span class="o">-</span> <span class="mi">100</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">))</span>
<span class="n">y_train_subset</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:]</span>
<span class="n">ypredtrain</span> <span class="o">=</span> <span class="n">ypredtrain</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:]</span>
<span class="n">val_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_val</span><span class="p">))</span>
<span class="n">test_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_val</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_val</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_indices</span><span class="p">,</span> <span class="n">y_train_subset</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Actual Values (Train)&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#1f77b4&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_indices</span><span class="p">,</span> <span class="n">ypredtrain</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predictions (Train)&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#aec7e8&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">val_indices</span><span class="p">,</span> <span class="n">y_val</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Actual Values (Val)&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#ff7f0e&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">val_indices</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predictions (Val)&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#ffbb78&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_indices</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Actual Values (Test)&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#2ca02c&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_indices</span><span class="p">,</span> <span class="n">ypred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predictions (Test)&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#98df8a&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Training, Validation, Test, and Predictions (SVR-RBF meta learner)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Index&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Actual / Predicted Values&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/43d8cce94e40c56f7cbaa2d59cbdfbc1dbae65fcad7dfbf1f71eab40e7588fce.png" src="_images/43d8cce94e40c56f7cbaa2d59cbdfbc1dbae65fcad7dfbf1f71eab40e7588fce.png" />
</div>
</div>
<p>Es decir, la predicción de nuevos datos está dada por:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">predict_og</span><span class="p">(</span><span class="n">sample</span><span class="p">):</span>
  <span class="n">samplelasso</span> <span class="o">=</span> <span class="n">modelolasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
  <span class="n">samplelridge</span> <span class="o">=</span> <span class="n">modeloridge</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
  <span class="n">samplellineal</span> <span class="o">=</span> <span class="n">modelolineal</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
  <span class="n">sample_set</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">samplelasso</span><span class="p">,</span> <span class="n">samplelridge</span><span class="p">,</span> <span class="n">samplellineal</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
  <span class="n">sample</span> <span class="o">=</span> <span class="n">sample_set</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;lasso&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;ridge&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="s1">&#39;lineal&#39;</span><span class="p">})</span>
  <span class="n">final_value</span> <span class="o">=</span> <span class="n">svr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">final_value</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Modelos.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><strong>Modelos base</strong></p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-bases"><strong>Modelos bases</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#funciones-utiles-e-importacion-de-datos-y-modelos-bases"><strong>Funciones útiles e importación de datos y modelos bases</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#seleccion-del-meta-learner"><strong>Selección del meta-learner</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#que-es-un-meta-learner">¿Qué es un meta-learner?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preparacion-de-datos-de-entrada-para-el-meta-learner">Preparación de datos de entrada para el meta-learner</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#meta-learner-con-3-modelos-base"><strong>Meta - learner con 3 modelos base</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regresion-lineal"><strong>Regresión lineal</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hiperparametrizacion-para-knn"><strong>Hiperparametrización para KNN</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hiperparametrizacion-para-ridge"><strong>Hiperparametrización para Ridge</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hiperparametrizacion-para-lasso"><strong>Hiperparametrización para Lasso</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hiperparametrizacion-para-arbol-de-decision"><strong>Hiperparametrización para árbol de decisión</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hiperparametrizacion-para-random-forest"><strong>Hiperparametrización para Random Forest</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hiperparametrizacion-para-xgboost"><strong>Hiperparametrización para XGBoost</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hiperparametrizacion-para-svr"><strong>Hiperparametrización para SVR</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resultados-generales"><strong>Resultados generales</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#meta-learner-con-4-modelos-bases"><strong>Meta-learner con 4 modelos bases</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1"><strong>Regresión lineal</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2"><strong>Hiperparametrización para KNN</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3"><strong>Hiperparametrización para Ridge</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4"><strong>Hiperparametrización para Lasso</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5"><strong>Hiperparametrización para árbol de decisión</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6"><strong>Hiperparametrización para Random Forest</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7"><strong>Hiperparametrización para XGBoost</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8"><strong>Hiperparametrización para SVR</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9"><strong>Resultados generales</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparacion-de-base-learners-y-meta-learners-con-4-y-3-base-learners"><strong>Comparación de base learners y meta learners con 4 y 3 base learners</strong></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Valentina Bustamante & Valentina Cabrera
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>